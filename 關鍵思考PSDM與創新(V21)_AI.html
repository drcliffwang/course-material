<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>關鍵思考與創新 PSDM + AI 課程</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* A lighter gray background */
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39);
        }
        .tab-button:not(.active):hover {
            background-color: #eef2ff;
            color: #3b82f6;
        }
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            padding: 2rem;
        }
        .ai-output {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Noto Sans TC', sans-serif;
        }
        .ai-output table { margin-top: 1rem; margin-bottom: 1rem; border-collapse: collapse; width: 100%; }
        .ai-output th, .ai-output td { border: 1px solid #d1d5db; padding: 0.75rem; text-align: left; }
        .ai-output th { background-color: #f9fafb; font-weight: 600; }
        .ai-output h3 { font-size: 1.25rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.75rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;}
        .ai-output h4 { font-size: 1.1rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
        .ai-output ul { list-style-type: disc; padding-left: 1.5rem; }
        .ai-output ol { list-style-type: decimal; padding-left: 1.5rem; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .quiz-feedback {
            margin-top: 0.5rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        .feedback-correct {
            background-color: #dcfce7;
            color: #166534;
            border-left: 4px solid #22c55e;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .content-block h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            border-left: 4px solid #3b82f6;
            padding-left: 0.75rem;
            margin-bottom: 1rem;
        }
        .content-block ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl font-bold text-blue-600 mb-2">關鍵思考與創新 PSDM + AI</h1>
            <p class="text-md md:text-lg text-gray-600">一門為您打造的系統性思維PSDM與 AI 協作實戰課程</p>
            <div class="mt-4 flex justify-center items-center space-x-4">
                <img src="https://raw.githubusercontent.com/drcliffwang/course-material/main/Cliff%20Baby%20Pic%20by%20GPT.png" alt="講師照片" class="rounded-full w-16 h-16 object-cover shadow-md">
                <div>
                    <p class="text-md font-semibold text-gray-700 text-left">Cliff Wang, Ph.D. 王啟岳博士</p>
                    <p class="text-sm text-gray-500 text-left">dr.cliffwang@a2psdm.com</p>
                    <p class="text-xs text-gray-400 mt-1 text-left">Copyright &copy; 2025</p>
                </div>
            </div>
            <!-- Podcast V21 Style -->
            <div class="mt-8 p-4 bg-gray-100 rounded-lg inline-block">
                <h4 class="font-semibold text-gray-700 mb-2">課程 Podcast</h4>
                <audio controls controlslist="nodownload" src="https://github.com/drcliffwang/course-material/raw/refs/heads/main/freecompress%20Critical%20Thinking%20and%20Innovation%20with%20AI.mp3" type="audio/mpeg">
                    您的瀏覽器不支援聲音播放功能。
                </audio>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8" id="tab-nav">
            <button class="tab-button active" onclick="showSection('overview')">課程概覽</button>
            <button class="tab-button" onclick="showSection('ai-setup')">AI 設定</button>
            <button class="tab-button" onclick="showSection('sa')">SA 狀況評估</button>
            <button class="tab-button" onclick="showSection('pa')">PA 問題分析</button>
            <button class="tab-button" onclick="showSection('ppa')">PPA 潛在問題分析</button>
            <button class="tab-button" onclick="showSection('da')">DA 決策分析</button>
            <button class="tab-button" onclick="showSection('ca')">CA 創意分析</button>
            <button class="tab-button" onclick="showSection('conclusion')">結論與討論</button>
        </nav>

        <main>
            <!-- Overview Section -->
            <section id="overview" class="content-section active">
                <div class="text-center mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">五大系統思考應用模塊</h2>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-6 text-center">
                    <div class="p-6 bg-white rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                        <h3 class="font-bold text-xl mb-2 text-blue-600">SA 狀況評估</h3>
                        <p class="text-5xl font-bold mb-2 text-blue-500">廣!</p><p class="text-gray-500">掌握大局</p>
                    </div>
                    <div class="p-6 bg-white rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                        <h3 class="font-bold text-xl mb-2 text-green-600">PA 問題分析</h3>
                        <p class="text-5xl font-bold mb-2 text-green-500">細!</p><p class="text-gray-500">問題解決</p>
                    </div>
                    <div class="p-6 bg-white rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                        <h3 class="font-bold text-xl mb-2 text-purple-600">PPA 潛在問題分析</h3>
                        <p class="text-5xl font-bold mb-2 text-purple-500">遠!</p><p class="text-gray-500">超前部署</p>
                    </div>
                    <div class="p-6 bg-white rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                        <h3 class="font-bold text-xl mb-2 text-yellow-600">DA 決策分析</h3>
                        <p class="text-5xl font-bold mb-2 text-yellow-500">準!</p><p class="text-gray-500">正確決策</p>
                    </div>
                    <div class="p-6 bg-white rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                        <h3 class="font-bold text-xl mb-2 text-red-600">CA 創意分析</h3>
                        <p class="text-5xl font-bold mb-2 text-red-500">變!</p><p class="text-gray-500">突破框架</p>
                    </div>
                </div>
            </section>

            <!-- AI Setup Section -->
            <section id="ai-setup" class="content-section">
                <div class="max-w-2xl mx-auto p-6 bg-blue-50 border-2 border-blue-200 rounded-lg card">
                    <h3 class="text-xl font-bold text-blue-800 text-center mb-4 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                        </svg>
                        啟動 AI 互動功能
                    </h3>
                    <p class="text-center text-blue-700 mb-4">為了使用課程中的 AI 實戰演練，請選擇您的 AI 服務並貼上對應的 API 金鑰。</p>
                    
                    <div class="mb-4">
                        <span class="block mb-2 font-semibold text-gray-700 text-center">1. 選擇 AI 服務提供商:</span>
                        <div class="flex justify-center flex-wrap gap-x-6 gap-y-2">
                            <label class="cursor-pointer"><input class="mr-1" type="radio" name="api-provider" value="gemini" checked> Google Gemini</label>
                            <label class="cursor-pointer"><input class="mr-1" type="radio" name="api-provider" value="deepseek"> Deepseek</label>
                            <label class="cursor-pointer"><input class="mr-1" type="radio" name="api-provider" value="chatgpt"> ChatGPT (OpenAI)</label>
                            <label class="cursor-pointer"><input class="mr-1" type="radio" name="api-provider" value="copilot"> Copilot (Microsoft)</label>
                        </div>
                    </div>

                    <div>
                        <span class="block mb-2 font-semibold text-gray-700 text-center">2. 輸入您的 API 金鑰:</span>
                        <div class="flex items-center">
                            <input type="password" id="api-key-input" class="w-full p-2 border border-blue-300 rounded-l-md focus:ring-2 focus:ring-blue-500" placeholder="在此貼上您選擇的服務金鑰...">
                            <button onclick="saveApiKey()" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-r-md hover:bg-blue-600">儲存</button>
                        </div>
                    </div>
                    
                    <div id="copilot-endpoint-container" class="hidden mt-4">
                        <span class="block mb-2 font-semibold text-gray-700 text-center">3. 輸入您的 Azure Endpoint:</span>
                        <div class="flex items-center">
                            <input type="text" id="endpoint-url-input" class="w-full p-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="例如: https://your-resource.openai.azure.com/">
                        </div>
                         <p class="text-xs text-center text-blue-600 mt-1">請確認 Endpoint 包含完整的部署名稱，例如 `.../deployments/your-deployment-name`</p>
                    </div>

                    <div class="text-xs text-center text-blue-600 mt-2 space-y-1">
                        <p>您的金鑰只會儲存在您目前的瀏覽器中。可從 <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline hover:text-blue-800">Google AI Studio</a>, <a href="https://platform.deepseek.com/api_keys" target="_blank" class="underline hover:text-blue-800">Deepseek</a>, 或 <a href="https://platform.openai.com/api-keys" target="_blank" class="underline hover:text-blue-800">OpenAI/Azure</a> 免費取得。</p>
                        <p class="font-bold">請注意：部分服務在免費額度用完後，可能需要您在該平台設定付款方式或儲值才能繼續使用。</p>
                    </div>
                </div>
            </section>

            <!-- SA Section -->
            <section id="sa" class="content-section card">
                <h2 class="text-2xl font-bold mb-4 text-center">SA: Situation Appraisal (狀況評估)</h2>
                <h3 class="text-xl text-gray-600 mb-6 text-center">掌握大局，理清頭緒</h3>
                
                <div class="content-block">
                    <h4>核心理念</h4>
                    <p>當面對一團混亂、千頭萬緒的狀況時，SA 提供一個系統性的方法來拆解複雜情境，確立優先順序，並決定下一步的行動方向。它是所有分析的起點，幫助我們從「見樹不見林」的困境中跳脫，看清全局。</p>
                </div>

                <div class="content-block">
                    <h4>關鍵步驟解析</h4>
                    <ul>
                        <li><b>1. 規劃議題 (Plan - 審問):</b> 將腦中所有待辦事項、擔憂、問題全部列出。接著運用 <b>MECE 原則 (相互獨立，完全窮盡)</b> 進行分類與歸納，將雜亂的關注點整理成幾個清晰、獨立的議題大項。</li>
                        <li><b>2. 輕重緩急 (Do - 慎思):</b> 資源有限，不可能所有事都做。針對每個議題，從<b>嚴重性(S)</b>、<b>緊急性(U)</b>、<b>未來性(G)</b>三個維度進行評估，找出真正需要優先處理的關鍵少數。</li>
                        <li><b>3. 決定流程 (Check - 明辨):</b> 針對高優先級的議題，判斷其問題屬性。這一步是關鍵的「分流站」：
                            <ul class="my-2">
                                <li>- 如果是「原因不明的偏差」，則進入 <b>PA (問題分析)</b>。</li>
                                <li>- 如果是「需要做出選擇」，則進入 <b>DA (決策分析)</b>。</li>
                                <li>- 如果是「未來可能發生的風險」，則進入 <b>PPA (潛在問題分析)</b>。</li>
                            </ul>
                        </li>
                        <li><b>4. 當責行動 (Action - 篤行):</b> 將分析轉化為行動。明確定義「誰(Who)」、「在何時(When)」、「做什麼(What)」，並啟動對應的分析流程。</li>
                    </ul>
                </div>
                
                <!-- Quiz Section for SA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">SA 學習成效測驗</h3>
                    <div id="quiz-sa" class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-4" data-correct="c">
                            <p class="font-semibold mb-2">1. 狀況評估(SA)最主要的核心目的是什麼？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q1-sa" value="a" class="mr-2">A. 找到問題的唯一真因</label>
                                <label class="block"><input type="radio" name="q1-sa" value="b" class="mr-2">B. 預防所有未來可能發生的風險</label>
                                <label class="block"><input type="radio" name="q1-sa" value="c" class="mr-2">C. 拆解複雜情況，理清頭緒並決定優先順序</label>
                                <label class="block"><input type="radio" name="q1-sa" value="d" class="mr-2">D. 產生最多樣化的創意點子</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <div data-correct="a">
                            <p class="font-semibold mb-2">2. 在SA中，使用MECE原則是為了達成什麼效果？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q2-sa" value="a" class="mr-2">A. 確保議題的劃分不重疊、不遺漏</label>
                                <label class="block"><input type="radio" name="q2-sa" value="b" class="mr-2">B. 確保每個議題都同樣重要</label>
                                <label class="block"><input type="radio" name="q2-sa" value="c" class="mr-2">C. 確保只找出最緊急的議題</label>
                                <label class="block"><input type="radio" name="q2-sa" value="d" class="mr-2">D. 確保所有議題都有解決方案</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <button onclick="submitQuiz('sa')" class="mt-4 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700">提交答案</button>
                        <div id="score-sa" class="mt-4 font-bold"></div>
                    </div>
                </div>

                <!-- Interactive AI Section for SA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-blue-700 mb-4">SA 實戰演練</h3>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <label for="sa-input" class="font-semibold text-gray-700">請在此描述您面臨的複雜情況：</label>
                            <button onclick="loadExample('sa-input')" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">載入範例</button>
                        </div>
                        <textarea id="sa-input" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" rows="5" placeholder="例如：我們公司最近面臨多個挑戰：客戶投訴增加了30%，主要集中在產品品質和客服回應時間；員工流失率從5%上升到15%，特別是技術部門；新產品開發進度落後原計畫2個月；競爭對手推出類似產品，搶佔了我們20%的市場份額；同時，供應鏈成本上漲15%，影響獲利能力。管理層對於應該優先處理哪個問題意見分歧。"></textarea>
                        <button onclick="handleAI('sa')" class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">
                            ✨ 啟動 AI 狀況評估
                        </button>
                        <div id="sa-output" class="ai-output hidden"></div>
                    </div>
                </div>
            </section>
            
            <!-- PA Section -->
            <section id="pa" class="content-section card">
                <h2 class="text-2xl font-bold mb-4 text-center">PA: Problem Analysis (問題分析)</h2>
                <h3 class="text-xl text-gray-600 mb-6 text-center">追根究柢，找到真因</h3>

                <div class="content-block">
                    <h4>核心理念</h4>
                    <p>當發生「實際」與「應有」的偏差 (Deviation)，且原因不明時，PA 提供一套嚴謹的邏輯工具。其精髓在於「比較」，透過系統性地比對「是(IS)」與「不是(IS NOT)」之間的差異，從而找出導致問題的「獨特變化」，鎖定真因。</p>
                </div>
                <div class="content-block">
                    <h4>關鍵步驟解析</h4>
                    <ul>
                        <li><b>1. 定義問題 (Plan - 審問):</b> 精準描述問題（物件＋偏差），並利用 <b>IS/IS NOT 表格</b>，從 What, Where, When, Extent 四個構面，鉅細靡遺地收集「事實」，而非意見或猜測。</li>
                        <li><b>2. 推理原因 (Do - 慎思):</b> 雙管齊下尋找可能原因。<b>演繹法</b>：從經驗出發，使用魚骨圖等工具發想。<b>歸納法</b>：專注於 IS/IS NOT 表格中的「差異點」和「變化點」，這是最客觀的線索來源。</li>
                        <li><b>3. 辯證原因 (Check - 明辨):</b> 這是最關鍵的驗證步驟。將上一步找出的「最可能原因(MPC)」，拿來解釋 IS/IS NOT 表格中的每一項事實。如果這個原因能完美解釋「為何發生在 IS，而未發生在 IS NOT」，那它很可能就是真因。</li>
                        <li><b>4. 決策執行 (Act - 篤行):</b> 透過實驗或觀察來最終確認真因。確認後，立即採取<b>治標行動 (Containment)</b> 防止災情擴大，並規劃<b>治本行動 (Corrective)</b> 根除問題。</li>
                    </ul>
                </div>

                <!-- Quiz Section for PA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">PA 學習成效測驗</h3>
                    <div id="quiz-pa" class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-4" data-correct="b">
                            <p class="font-semibold mb-2">1. 在問題分析(PA)中，「IS / IS NOT」分析的主要作用是什麼？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q1-pa" value="a" class="mr-2">A. 評估問題的嚴重性</label>
                                <label class="block"><input type="radio" name="q1-pa" value="b" class="mr-2">B. 透過比較來縮小可能原因的範圍</label>
                                <label class="block"><input type="radio" name="q1-pa" value="c" class="mr-2">C. 決定由誰來負責解決問題</label>
                                <label class="block"><input type="radio" name="q1-pa" value="d" class="mr-2">D. 提出創新的解決方案</label>
                            </div>
                             <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <div data-correct="d">
                            <p class="font-semibold mb-2">2. 當你找到一個「最可能原因(MPC)」時，下一步應該做什麼來驗證它？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q2-pa" value="a" class="mr-2">A. 馬上投入資源解決它</label>
                                <label class="block"><input type="radio" name="q2-pa" value="b" class="mr-2">B. 尋找更多可能的原因</label>
                                <label class="block"><input type="radio" name="q2-pa" value="c" class="mr-2">C. 忽略它，專注於治標行動</label>
                                <label class="block"><input type="radio" name="q2-pa" value="d" class="mr-2">D. 用它來解釋IS/IS NOT表格中的所有事實，看是否吻合</label>
                            </div>
                             <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <button onclick="submitQuiz('pa')" class="mt-4 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700">提交答案</button>
                        <div id="score-pa" class="mt-4 font-bold"></div>
                    </div>
                </div>

                <!-- Interactive AI Section for PA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-green-700 mb-4">PA 實戰演練</h3>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="mb-4">
                            <span class="block mb-2 font-semibold text-gray-700">請選擇分析方法：</span>
                            <div class="flex flex-wrap gap-x-4 gap-y-2">
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="pa-method" value="isisnot" checked> IS/IS NOT 分析</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="pa-method" value="whywhy"> Why-Why 分析</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="pa-method" value="pmanalysis"> PM 分析</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="pa-method" value="datadriven"> Data Driven 分析</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="pa-method" value="8dreport"> 8D 報告</label>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="pa-input" class="font-semibold text-gray-700">請在此描述您遇到的問題與相關數據：</label>
                            <button onclick="loadExample('pa-input')" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">載入範例</button>
                        </div>
                        <textarea id="pa-input" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500" rows="5" placeholder="例如：A款手機外殼塗漆出現裂縫。問題只發生在台中廠的A產線 (Location: 大地點)，且集中在外殼的右上角 (Position: 小位置)。問題是從昨天(Time: 時間點)開始，呈現週期性發生(Pattern: 模式)，且通常在早上10點的班次(Life Cycle: 生命週期)出現。高雄廠的A產線、B款手機、或昨天以前則正常。"></textarea>
                        <button onclick="handleAI('pa')" class="mt-4 px-6 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700">
                            ✨ 啟動 AI 問題分析
                        </button>
                        <div id="pa-output" class="ai-output hidden"></div>
                    </div>
                </div>
            </section>

            <!-- PPA Section -->
            <section id="ppa" class="content-section card">
                <h2 class="text-2xl font-bold mb-4 text-center">PPA: Potential Problem Analysis (潛在問題分析)</h2>
                <h3 class="text-xl text-gray-600 mb-6 text-center">超前部署，防範未然</h3>

                <div class="content-block">
                    <h4>核心理念</h4>
                    <p>任何計畫或行動都伴隨著風險。PPA 是一套將「被動救火」轉為「主動防災」の系統化方法。它讓我們在行動前，先系統性地思考「哪裡可能出錯？」，並預先制定「預防」與「應變」計畫，大幅提高計畫の成功率。</p>
                </div>
                 <div class="content-block">
                    <h4>關鍵步驟解析</h4>
                    <ul>
                        <li><b>1. 識別風險 (Plan):</b> 針對計畫的每個步驟，腦力激盪所有可能發生的潛在問題。</li>
                        <li><b>2. 優先次序 (Do):</b> 對每個風險進行量化評估。<b>RPN (風險優先數) = S (嚴重性) x O (發生率) x D (難檢測度)</b>。這個分數能幫助我們客觀地找出最需要關注的高風險項目。</li>
                        <li><b>3. 分析原因 (Check):</b> 針對 RPN 最高的風險，進一步分析可能導致它發生的原因 (Likely Causes)。</li>
                        <li><b>4. 制定對策 (Action):</b> 這是 PPA 的行動核心，分為兩個層面：
                            <ul class="my-2">
                                <li>- <b>預防行動 (Prevention - Plan A):</b> 針對「原因」下手，採取措施來降低風險的「發生率(O)」。例如：增加教育訓練、建立防呆機制。</li>
                                <li>- <b>應變行動 (Contingency - Plan B):</b> 假設風險不幸發生，預先準備好對策以降低「嚴重性(S)」。同時也要思考如何提高「檢測度(D)」，例如增加警報器。</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <!-- Quiz Section for PPA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">PPA 學習成效測驗</h3>
                    <div id="quiz-ppa" class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-4" data-correct="d">
                            <p class="font-semibold mb-2">1. 在PPA中，RPN (風險優先數) 是由哪三個因素相乘得出的？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q1-ppa" value="a" class="mr-2">A. 嚴重性、緊急性、未來性</label>
                                <label class="block"><input type="radio" name="q1-ppa" value="b" class="mr-2">B. 成本、時間、品質</label>
                                <label class="block"><input type="radio" name="q1-ppa" value="c" class="mr-2">C. 可能性、影響力、可控性</label>
                                <label class="block"><input type="radio" name="q1-ppa" value="d" class="mr-2">D. 嚴重性(S)、發生率(O)、難檢測度(D)</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <div data-correct="a">
                            <p class="font-semibold mb-2">2. 「為新設備準備備用零件」是屬於PPA中的哪一種行動？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q2-ppa" value="a" class="mr-2">A. 應變行動 (Contingency - Plan B)</label>
                                <label class="block"><input type="radio" name="q2-ppa" value="b" class="mr-2">B. 預防行動 (Prevention - Plan A)</label>
                                <label class="block"><input type="radio" name="q2-ppa" value="c" class="mr-2">C. 治本行動 (Corrective Action)</label>
                                <label class="block"><input type="radio" name="q2-ppa" value="d" class="mr-2">D. 治標行動 (Containment Action)</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <button onclick="submitQuiz('ppa')" class="mt-4 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700">提交答案</button>
                        <div id="score-ppa" class="mt-4 font-bold"></div>
                    </div>
                </div>

                <!-- Interactive AI Section for PPA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-purple-700 mb-4">PPA 實戰演練</h3>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                           <label for="ppa-input" class="font-semibold text-gray-700">請在此描述您的計畫或專案：</label>
                           <button onclick="loadExample('ppa-input')" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">載入範例</button>
                        </div>
                        <textarea id="ppa-input" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500" rows="5" placeholder="例如：我們計畫在三個月內推出新的智慧手錶產品。專案包括：第一個月完成軟體開發和硬體整合測試；第二個月進行用戶測試和生產準備；第三個月開始量產和市場推廣。團隊包括10名工程師、5名設計師、3名專案經理。預算為500萬元，目標首月銷售10,000台。這是公司首次進入穿戴裝置市場。"></textarea>
                        <button onclick="handleAI('ppa')" class="mt-4 px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700">
                            ✨ 啟動 AI 風險分析
                        </button>
                        <div id="ppa-output" class="ai-output hidden"></div>
                    </div>
                </div>
            </section>

            <!-- DA Section -->
            <section id="da" class="content-section card">
                <h2 class="text-2xl font-bold mb-4 text-center">DA: Decision Analysis (決策分析)</h2>
                <h3 class="text-xl text-gray-600 mb-6 text-center">權衡利弊，做出最佳選擇</h3>
                
                <div class="content-block">
                    <h4>核心理念</h4>
                    <p>將決策過程從「直覺」和「感覺」提升到「系統」和「計算」。DA 提供了一個結構化、透明化的流程，將複雜的選擇題拆解為可評估的標準，讓團隊或個人能客觀地權衡利弊，並對最終選擇的風險有清晰的認識。</p>
                </div>
                <div class="content-block">
                    <h4>關鍵步驟解析</h4>
                    <ul>
                        <li><b>1. 規劃需求 (Plan):</b> 這是決策的基礎。清楚定義決策的目的，並將評估標準分為兩類：
                            <ul class="my-2">
                                <li>- <b>Musts (必要條件):</b> 非有不可的門檻，用來「篩選」選項，不滿足者直接淘汰。</li>
                                <li>- <b>Wants (想要條件):</b> 多多益善的加分項，用來「評分」。必須給予每個 Want 不同的「權重(Weight)」，以體現其相對重要性。</li>
                            </ul>
                        </li>
                        <li><b>2. 發展選項 (Do):</b> 進行評分與計算。先用 Musts 篩掉不合格的選項。然後為剩下的選項，根據 Wants 逐項評分 (1-10分)，再將分數乘以權重，得出每個選項的加權總分。</li>
                        <li><b>3. 了解風險 (Check):</b> 分數不是一切。針對分數最高的幾個選項，必須冷靜地分析其潛在的負面風險 (Adverse Consequences)。一個高分但風險極大的選項，未必是最佳選擇。</li>
                        <li><b>4. 執行決策 (Action):</b> 做出最終選擇。理想的選擇是「加權分數最高」且「風險可控」的選項。一旦做出決定，就要為可能的風險制定應對計畫。</li>
                    </ul>
                </div>

                <!-- Quiz Section for DA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">DA 學習成效測驗</h3>
                    <div id="quiz-da" class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-4" data-correct="c">
                            <p class="font-semibold mb-2">1. 在決策分析(DA)中，「Musts (必要條件)」的主要作用是什麼？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q1-da" value="a" class="mr-2">A. 用來為選項加權計分</label>
                                <label class="block"><input type="radio" name="q1-da" value="b" class="mr-2">B. 評估選項的潛在風險</label>
                                <label class="block"><input type="radio" name="q1-da" value="c" class="mr-2">C. 作為篩選門檻，快速淘汰不合格的選項</label>
                                <label class="block"><input type="radio" name="q1-da" value="d" class="mr-2">D. 比較不同選項的優點</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <div data-correct="b">
                            <p class="font-semibold mb-2">2. 為何在DA中要為「Wants (想要條件)」設定權重(Weight)？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q2-da" value="a" class="mr-2">A. 讓計算過程更複雜</label>
                                <label class="block"><input type="radio" name="q2-da" value="b" class="mr-2">B. 體現不同標準的相對重要性</label>
                                <label class="block"><input type="radio" name="q2-da" value="c" class="mr-2">C. 確保所有選項得分都一樣</label>
                                <label class="block"><input type="radio" name="q2-da" value="d" class="mr-2">D. 這是隨機設定的數字</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <button onclick="submitQuiz('da')" class="mt-4 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700">提交答案</button>
                        <div id="score-da" class="mt-4 font-bold"></div>
                    </div>
                </div>

                <!-- Interactive AI Section for DA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-yellow-700 mb-4">DA 實戰演練</h3>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                           <label for="da-input" class="font-semibold text-gray-700">請在此描述您需要做的決策 (包含選項、評估標準 Wants 及權重)：</label>
                           <button onclick="loadExample('da-input')" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">載入範例</button>
                        </div>
                        <textarea id="da-input" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500" rows="5" placeholder="例如：我們需要選擇新的雲端服務供應商。目前有三個選項：AWS、Azure、Google Cloud。主要考量因素(Wants)與權重為：成本控制(權重9)、技術支援品質(權重8)、資料安全性(權重9)、系統整合難易度(權重8)、未來擴展性(權重7)、AI功能(權重6)。我們的必要條件(Musts)是：必須符合本地資料法規、提供24/7中文技術支援。"></textarea>
                        <button onclick="handleAI('da')" class="mt-4 px-6 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600">
                            ✨ 啟動 AI 決策分析
                        </button>
                        <div id="da-output" class="ai-output hidden"></div>
                    </div>
                </div>
            </section>

            <!-- CA Section -->
            <section id="ca" class="content-section card">
                <h2 class="text-2xl font-bold mb-4 text-center">CA: Creativity Analysis (創意分析)</h2>
                <h3 class="text-xl text-gray-600 mb-6 text-center">突破框架，系統創新</h3>

                <div class="content-block">
                    <h4>核心理念</h4>
                    <p>創新並非少數天才的專利，而是人人皆可學習的方法。CA 提供了一套系統化的 IDEA 框架，引導我們將發散的「點子(Idea)」轉化為有市場價值的「創新(Innovation)」。它教我們如何從客戶需求出發，透過系統工具演化點子，並最終打造出成功的商業模式。</p>
                </div>
                <div class="content-block">
                    <h4>IDEA 創新框架解析</h4>
                    <ul>
                        <li><b>I - Imagination / Input / Insight (想像/輸入/洞見):</b> 創新的起點。透過同理心(Empathy)觀察，深入了解客戶的痛點(Pains)與爽點(Gains)，從中發掘未被滿足的需求。</li>
                        <li><b>D - Domain Application (運用場景):</b> 尋找創新的「空隙」。思考將現有的技術或產品，應用到新的時間、空間或物件上。例如，將工業用纖維棉應用到個人衛生領域，誕生了衛生棉。</li>
                        <li><b>E - Evolution / Evaluation (連接演化):</b> 系統性地讓點子「進化」。運用 <b>SCAMPER</b> (替代/結合/調整/修改/他用/消除/重排) 或 <b>TRIZ (發明性問題解決理論)</b> 等工具，對現有方案進行破壞式重組，產生新的可能性。</li>
                        <li><b>A - Action (創新行動方案):</b> 將成熟的創意落地。使用<b>設計思維(Design Thinking)</b>來快速迭代原型，透過<b>價值主張圖(VPC)</b>確保產品與市場契合，最後用<b>商業模式圖(BMC)</b>規劃出可持續獲利的模式。</li>
                    </ul>
                </div>
                
                <!-- Quiz Section for CA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">CA 學習成效測驗</h3>
                    <div id="quiz-ca" class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-4" data-correct="d">
                            <p class="font-semibold mb-2">1. 在IDEA創新框架中，哪一個階段最著重於透過同理心來了解客戶的痛點與爽點？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q1-ca" value="a" class="mr-2">A. D (Domain Application)</label>
                                <label class="block"><input type="radio" name="q1-ca" value="b" class="mr-2">B. E (Evolution)</label>
                                <label class="block"><input type="radio" name="q1-ca" value="c" class="mr-2">C. A (Action)</label>
                                <label class="block"><input type="radio" name="q1-ca" value="d" class="mr-2">D. I (Insight)</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <div data-correct="b">
                            <p class="font-semibold mb-2">2. SCAMPER工具中的「C」代表什麼意思？</p>
                            <div class="space-y-2">
                                <label class="block"><input type="radio" name="q2-ca" value="a" class="mr-2">A. 複製 (Copy)</label>
                                <label class="block"><input type="radio" name="q2-ca" value="b" class="mr-2">B. 結合 (Combine)</label>
                                <label class="block"><input type="radio" name="q2-ca" value="c" class="mr-2">C. 挑戰 (Challenge)</label>
                                <label class="block"><input type="radio" name="q2-ca" value="d" class="mr-2">D. 改變 (Change)</label>
                            </div>
                            <div class="quiz-feedback hidden mt-2"></div>
                        </div>
                        <button onclick="submitQuiz('ca')" class="mt-4 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700">提交答案</button>
                        <div id="score-ca" class="mt-4 font-bold"></div>
                    </div>
                </div>

                <!-- Interactive AI Section for CA -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-red-700 mb-4">CA 實戰演練</h3>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="mb-4">
                            <span class="block mb-2 font-semibold text-gray-700">請選擇分析方法：</span>
                            <div class="flex flex-wrap gap-x-4 gap-y-2">
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="scamper" checked> SCAMPER</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="triz"> TRIZ</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="sixhats"> 六頂思考帽</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="designthinking"> 設計思維</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="vpc"> 價值主張圖 (VPC)</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="bmc"> 商業模式圖 (BMC)</label>
                                <label class="cursor-pointer"><input class="mr-1" type="radio" name="ca-method" value="pyramid"> 金字塔原理</label>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="ca-input" class="font-semibold text-gray-700">請在此輸入您想創新的主題或產品：</label>
                            <button onclick="loadExample('ca-input')" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">載入範例</button>
                        </div>
                        <textarea id="ca-input" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500" rows="5" placeholder="例如：如何提升實體書店的來客數與營收，以應對電商的衝擊？"></textarea>
                        <button onclick="handleAI('ca')" class="mt-4 px-6 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700">
                            ✨ 啟動 AI 創意分析
                        </button>
                        <div id="ca-output" class="ai-output hidden"></div>
                    </div>
                </div>
            </section>

            <!-- Conclusion Section -->
            <section id="conclusion" class="content-section card">
                 <h2 class="text-2xl font-bold mb-6 text-center">結論與討論</h2>
                 <div class="max-w-4xl mx-auto">
                    <div class="mb-6">
                        <a href="https://raw.githubusercontent.com/drcliffwang/course-material/main/Mermaid%20PSDM.png" target="_blank" title="點擊放大">
                            <img src="https://raw.githubusercontent.com/drcliffwang/course-material/main/Mermaid%20PSDM.png" alt="課程總結心智圖" class="w-full rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-shadow duration-300">
                        </a>
                        <p class="text-center text-sm text-gray-500 mt-2">課程總結心智圖 (點擊放大)</p>
                    </div>
                    <ul class="list-none space-y-4 text-left text-lg">
                        <li class="flex items-start"><span class="text-blue-500 font-bold mr-3 mt-1">✓</span> <span><b>一個關鍵思考整合：</b>邏輯思維 (左腦) 與創意思維 (右腦) 的交互運作。</span></li>
                        <li class="flex items-start"><span class="text-blue-500 font-bold mr-3 mt-1">✓</span> <span><b>二個邏輯必須兼具：</b>演繹法與歸納法。</span></li>
                        <li class="flex items-start"><span class="text-blue-500 font-bold mr-3 mt-1">✓</span> <span><b>三個層次檢視：</b>議題層、論證邏輯層、結論行動層。</span></li>
                        <li class="flex items-start"><span class="text-blue-500 font-bold mr-3 mt-1">✓</span> <span><b>四個步驟循環：</b>以 PDCA 處理邏輯問題，以 IDEA 框架激發創新。</span></li>
                        <li class="flex items-start"><span class="text-blue-500 font-bold mr-3 mt-1">✓</span> <span><b>五個 AI 應用場景：</b>在 SA, PA, PPA, DA, CA 中，善用 AI 作為輔助工具。</span></li>
                    </ul>
                    
                    <div class="mt-8 text-center">
                        <a href="https://github.com/drcliffwang/course-material/raw/main/PSDM%20Excel%20Template.xlsx" 
                           download="PSDM Excel Template.xlsx"
                           class="inline-block px-8 py-3 bg-green-600 text-white font-bold text-lg rounded-lg shadow-lg hover:bg-green-700 transition-transform transform hover:-translate-y-1 duration-300">
                           下載練習檔 (PSDM Excel Template.xlsx)
                        </a>
                    </div>
    
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <p class="font-bold text-xl text-center text-gray-800"><b>最終目標：</b>以人腦的智慧與判斷力為主導，駕馭 AI 的強大算力與知識庫，成為未來職場中無可取代的關鍵人才。</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
    // --- Initial Setup ---
    document.addEventListener('DOMContentLoaded', () => {
        // Show the first section by default
        showSection('overview');
        // Setup dynamic placeholders
        setupDynamicPlaceholders();
    });

    // --- Tab Navigation ---
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        // Deactivate all tabs
        document.querySelectorAll('#tab-nav .tab-button').forEach(tab => {
            tab.classList.remove('active');
        });

        // Show selected section and activate corresponding tab
        document.getElementById(sectionId).classList.add('active');
        const activeButton = document.querySelector(`#tab-nav .tab-button[onclick="showSection('${sectionId}')"]`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
    }

    // --- API Key Logic ---
    let userApiKey = '';
    let apiProvider = 'gemini'; // Default provider
    let userEndpointUrl = ''; // For Azure/Copilot

    document.querySelectorAll('input[name="api-provider"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const endpointContainer = document.getElementById('copilot-endpoint-container');
            apiProvider = this.value;
            if (this.value === 'copilot') {
                endpointContainer.classList.remove('hidden');
            } else {
                endpointContainer.classList.add('hidden');
            }
        });
    });

    function saveApiKey() {
        const keyInput = document.getElementById('api-key-input');
        const endpointInput = document.getElementById('endpoint-url-input');
        
        if (keyInput.value.trim()) {
            userApiKey = keyInput.value.trim();
            if (apiProvider === 'copilot') {
                if (endpointInput.value.trim()) {
                    userEndpointUrl = endpointInput.value.trim();
                    alert(`API 金鑰與 Endpoint 已儲存！您現在選擇的服務是 ${apiProvider.toUpperCase()}。`);
                } else {
                    alert('使用 Copilot (Azure) 時，請務必輸入您的 Endpoint URL。');
                    return;
                }
            } else {
                 alert(`API 金鑰已儲存！您現在選擇的服務是 ${apiProvider.toUpperCase()}。`);
            }
        } else {
            alert('請輸入有效的 API 金鑰。');
        }
    }

    // --- AI Interaction Logic ---
    async function callAI(prompt, apiKey, provider, endpoint) {
        let apiUrl = '';
        let headers = { 'Content-Type': 'application/json' };
        let body = {};

        try {
            switch (provider) {
                case 'gemini':
                    apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                    body = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        ]
                    };
                    break;
                case 'deepseek':
                    apiUrl = 'https://api.deepseek.com/v1/chat/completions';
                    headers['Authorization'] = `Bearer ${apiKey}`;
                    body = {
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: "你是一位專業的顧問，請使用繁體中文回答。" },
                            { role: "user", content: prompt }
                        ]
                    };
                    break;
                case 'chatgpt':
                    apiUrl = 'https://api.openai.com/v1/chat/completions';
                    headers['Authorization'] = `Bearer ${apiKey}`;
                    body = {
                        model: "gpt-4o",
                        messages: [
                            { role: "system", content: "You are a helpful assistant. Please respond in Traditional Chinese." },
                            { role: "user", content: prompt }
                        ]
                    };
                    break;
                case 'copilot':
                    apiUrl = endpoint;
                    headers['api-key'] = apiKey;
                    body = {
                        messages: [
                            { role: "system", content: "You are a helpful assistant. Please respond in Traditional Chinese." },
                            { role: "user", content: prompt }
                        ]
                    };
                    break;
                default:
                    return { success: false, error: '未知的 AI 服務提供商。' };
            }

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(body)
            });

            const result = await response.json();

            if (!response.ok) {
                const errorMsg = result?.error?.message || JSON.stringify(result);
                throw new Error(`API 請求失敗 (狀態碼 ${response.status}): ${errorMsg}`);
            }

            if (provider === 'gemini') {
                if (result.promptFeedback?.blockReason) {
                    return { success: false, error: `請求因安全因素被阻擋：${result.promptFeedback.blockReason}` };
                }
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    return { success: true, text: result.candidates[0].content.parts[0].text };
                }
                return { success: false, error: 'AI 回應格式有誤或為空 (Gemini)。' };
            } else { 
                if (result.choices && result.choices[0]?.message?.content) {
                    return { success: true, text: result.choices[0].message.content };
                }
                return { success: false, error: 'AI 回應格式有誤或為空。' };
            }

        } catch (error) {
            console.error("Error calling AI API:", error);
            let friendlyError = `無法連接至 AI 服務。請檢查您的網路連線、API 金鑰及 Endpoint (如適用) 是否正確。`;
            if (error.message.includes("API 請求失敗")) {
                friendlyError = error.message; 
            } else if (error.name === 'TypeError') {
                friendlyError += ' 可能的原因是網路問題或 CORS 跨域錯誤。'
            }
            return { success: false, error: friendlyError };
        }
    }

    async function handleAI(type) {
        if (apiProvider === 'copilot' && (!userApiKey || !userEndpointUrl)) {
            alert('請先在「AI 設定」分頁中輸入並儲存您的 API 金鑰與 Azure Endpoint！');
            showSection('ai-setup');
            document.getElementById('api-key-input').focus();
            return;
        }
        if (apiProvider !== 'copilot' && !userApiKey) {
            alert('請先在「AI 設定」分頁中輸入並儲存您的 API 金鑰！');
            showSection('ai-setup');
            document.getElementById('api-key-input').focus();
            return;
        }

        const inputElement = document.getElementById(`${type}-input`);
        const outputElement = document.getElementById(`${type}-output`);
        const userInput = inputElement.value.trim();

        if (!userInput) {
            alert("請先輸入您的情境或問題！");
            return;
        }

        outputElement.innerHTML = '<div class="loader"></div>';
        outputElement.classList.remove('hidden');

        let prompt = generatePrompt(type, userInput);
        
        const result = await callAI(prompt, userApiKey, apiProvider, userEndpointUrl);

        if (result.success) {
            outputElement.innerHTML = marked.parse(result.text);
        } else {
            outputElement.innerHTML = `<div class="p-4 bg-red-100 border border-red-300 text-red-800 rounded-lg">
                <p class="font-bold">發生錯誤</p>
                <p class="mt-2 text-sm">${result.error}</p>
            </div>`;
        }
    }

    function generatePrompt(type, userInput) {
        const selectedCaMethod = document.querySelector('input[name="ca-method"]:checked')?.value;

        switch (type) {
            case 'sa':
                return `作為一名頂尖的管理顧問，請對以下複雜情況進行狀況評估(SA)。請遵循以下結構化步驟，並以繁體中文回答：
### 1. 識別與歸納議題 (MECE原則)
從使用者描述中，提取所有關注點，並運用MECE原則將它們歸納成幾個獨立且完整的核心議題。
### 2. 優先級評估 (SUG評分)
為每個核心議題，從嚴重性(S)、緊急性(U)、未來性(G)三個維度進行1-10分的評分，並計算總分以確定優先順序。請以Markdown表格呈現。
### 3. 建議行動流程
針對最高優先級的議題，明確建議下一步應進入哪個分析流程 (PA, DA, 或 PPA)，並簡述理由。

使用者情境：\n${userInput}`;
            case 'pa':
                const selectedPaMethod = document.querySelector('input[name="pa-method"]:checked').value;
                if (selectedPaMethod === 'isisnot') {
                    return `作為一名經驗豐富的品管專家，請使用Kepner-Tregoe的IS/IS NOT方法，對以下問題進行深入分析。請遵循以下結構，並以繁體中文回答：
### 1. 問題定義
精確定義問題的「主體」與「偏差」。
### 2. IS / IS NOT 分析表
建立一個Markdown表格，從What, Where, When, Extent四個構面，詳細列出問題的「IS(是)」與「IS NOT(不是)」的事實。
- 在 **Where** 構面，請明確區分 **Location(大地點)** 和 **Position(小位置)**。
- 在 **When** 構面，請明確區分 **Time(時間點)**、**Pattern(模式，如：週期性、持續性、偶發性)** 和 **Life Cycle(生命週期)**。
### 3. 差異點與變化分析
基於上表，找出最關鍵的「差異點」和「相關變化」。
### 4. 最可能原因(MPC)推論
根據差異點和變化，提出1-3個最可能的原因，並詳細解釋你的推論邏輯。
### 5. 驗證建議
提出具體的下一步行動建議，以驗證你所推論的最可能原因。

使用者問題描述：\n${userInput}`;
                } else if (selectedPaMethod === 'pmanalysis') {
                    return `你是一位精通 PM Analysis (Physical Mechanism Analysis) 的工程專家。請嚴格遵循以下五個步驟，對使用者提出的問題進行分析，並以繁體中文回答。請用漏油問題的例子來思考並對應說明：
### 1. 現象 (Phenomenon)
明確化異常現象，不帶任何推測。
### 2. 物理現象 (Physical Phenomenon)
找出可直接觀察或量測的物理量變化。例如：間隙增大、壓力超限、表面龜裂。
### 3. 物理機制 (Physical Mechanism)
用物理定律或機械原理解釋物理現象的成因。例如：壓力-面積關係(F=P*A)、熱膨脹差異、材料疲勞。
### 4. 原因 (Cause)
從物理機制回推到實際造成此狀況的根本原因。例如：設計壓縮率不足、材質耐溫不足、安裝不良。
### 5. 驗證 (Verification)
設計具體的實驗或測試方法，來驗證假設的機制與原因是否正確。

使用者問題描述：\n${userInput}`;
                }
                // Add other PA methods here...
                return `你是一位根本原因分析專家，請根據使用者選擇的 ${selectedPaMethod} 方法，對以下問題進行分析，並以結構化、條列式的方式呈現結果。請用繁體中文回答。\n\n使用者問題描述：${userInput}`;
            case 'ppa':
                return `作為一名資深的風險管理師，請使用潛在問題分析(PPA)/FMEA方法，為以下計畫進行風險分析。請遵循以下結構，並以繁體中文回答：
### 1. 潛在問題識別
針對計畫的關鍵步驟，腦力激盪出至少5個潛在的風險或問題點。
### 2. RPN風險評估表
建立一個Markdown表格，對每個風險評估其嚴重性(S)、發生率(O)與難檢測度(D) (1-10分)，並計算RPN (S*O*D)。
### 3. 高風險項目分析
選出RPN最高的2-3個風險。
### 4. 預防與應變對策
針對選出的高風險項目，分別提出具體的「預防行動(Plan A)」以降低發生率，以及「應變行動(Plan B)」以降低衝擊或提高檢測率。

使用者計畫：\n${userInput}`;
            case 'da':
                return `作為一名理性的決策分析專家，請使用決策分析(DA)方法，協助使用者做決定。請遵循以下結構，並以繁體中文回答：
### 1. 決策目標與標準
明確決策目標，並從使用者輸入中區分出「必要條件(Musts)」和「想要條件(Wants)」及其權重。
### 2. 決策矩陣評分
建立一個Markdown表格。先用Musts篩選選項。然後對通過篩選的選項，根據Wants逐項評分(1-10分)，並計算加權總分。
### 3. 風險分析
針對加權分數最高的1-2個選項，分析其潛在的負面風險(Adverse Consequences)。
### 4. 最終決策建議
綜合分數與風險分析，提出一個明確的決策建議，並說明理由。

使用者決策情境：\n${userInput}`;
            case 'ca':
                if (selectedCaMethod === 'vpc') {
                    return `你是一位市場策略專家，請嚴格使用「價值主張圖 (Value Proposition Canvas)」框架，針對以下主題進行分析。**禁止**使用任何其他框架（如Vision, Problem, Solution）。請遵循以下結構，並以繁體中文回答：
### 1. 顧客輪廓 (Customer Profile) - 右側
- **顧客任務 (Customer Jobs):** 顧客試圖完成什麼？
- **痛點 (Pains):** 什麼困擾著顧客？
- **獲益 (Gains):** 顧客想獲得什麼？
### 2. 價值地圖 (Value Map) - 左側
- **產品與服務 (Products & Services):** 你的產品是什麼？
- **痛點解方 (Pain Relievers):** 你的產品如何緩解顧客痛點？
- **獲益創造者 (Gain Creators):** 你的產品如何為顧客創造獲益？
### 3. 契合度分析
簡要說明你的價值地圖如何與顧客輪廓相契合。

使用者主題：\n${userInput}`;
                }
                return `作為一名充滿創意的創新顧問，請使用「${selectedCaMethod}」方法，針對以下主題，發想創新的點子。請提供結構化、具體且有創意的想法。請用繁體中文回答。\n\n使用者主題：${userInput}`;
        }
    }

    // --- Load Example & Dynamic Placeholder Logic ---
    function loadExample(textareaId) {
        const textarea = document.getElementById(textareaId);
        if (textarea && textarea.placeholder) {
            const exampleText = textarea.placeholder.replace(/^例如：/, '').trim();
            textarea.value = exampleText;
            textarea.focus();
        }
    }

    function setupDynamicPlaceholders() {
        // PA Dynamic Placeholder
        const paRadioButtons = document.querySelectorAll('input[name="pa-method"]');
        const paTextarea = document.getElementById('pa-input');
        const paExamples = {
            isisnot: "例如：A款手機外殼塗漆出現裂縫。問題只發生在台中廠的A產線 (Location: 大地點)，且集中在外殼的右上角 (Position: 小位置)。問題是從昨天(Time: 時間點)開始，呈現週期性發生(Pattern: 模式)，且通常在早上10點的班次(Life Cycle: 生命週期)出現。高雄廠的A產線、B款手機、或昨天以前則正常。",
            whywhy: "例如：我們發現產品在客戶端的故障率增加了5%。",
            pmanalysis: "例如：我們公司的油壓缸缸蓋右側，最近觀察到持續滲油，地面有油滴。",
            datadriven: "例如：我想為季節性商品『聖誕主題馬克杯』決定最佳訂購量。已知每個杯子成本100元，售價350元，季末沒賣掉的只能當廢品處理(殘值0)。根據往年銷售數據，預估需求呈常態分佈，平均為500個，標準差為80個。",
            "8dreport": "例如：我們的客戶 XYZ 公司投訴，上一批交付的零件 (料號 #12345) 有 10% 的比例出現表面刮痕。"
        };
        paRadioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    paTextarea.placeholder = paExamples[this.value] || "請輸入問題描述...";
                }
            });
        });

        // CA Dynamic Placeholder
        const caRadioButtons = document.querySelectorAll('input[name="ca-method"]');
        const caTextarea = document.getElementById('ca-input');
        const caExamples = {
            scamper: "例如：如何提升實體書店的來客數與營收，以應對電商的衝擊？",
            triz: "例如：我想要手機電池續航力更長(增強)，但又不希望電池體積變大變重(減弱)。",
            sixhats: "例如：公司是否應該全面推行居家辦公(WFH)政策？",
            designthinking: "例如：如何改善大學生在校園內的用餐體驗？",
            vpc: "例如：為忙碌但注重健康的都市上班族，設計一款個人化的訂閱制健康餐盒服務。",
            bmc: "例如：承接VPC的分析，為『個人化訂閱制健康餐盒』服務規劃一個完整的商業模式。",
            pyramid: "例如：我想向管理層提議，公司應該投資導入新的AI客服系統。"
        };
        caRadioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    caTextarea.placeholder = caExamples[this.value] || "請輸入主題...";
                }
            });
        });
    }
    
    // --- Quiz Logic ---
    const quizExplanations = {
        'q1-sa': 'SA的核心是面對複雜情況時，先進行系統性的拆解與排序，以掌握全局，而非直接跳入解決方案。',
        'q2-sa': 'MECE (Mutually Exclusive, Collectively Exhaustive) 意思是「相互獨立，完全窮盡」，是確保邏輯結構嚴謹的黃金法則。',
        'q1-pa': 'PA的精髓在於透過比較「發生(IS)」與「未發生(IS NOT)」的各項條件，找出其中的「差異」，這些差異點就是找到根本原因的關鍵線索。',
        'q2-pa': '找到最可能原因(MPC)後，必須用它來反向驗證，看它是否能合理解釋所有已知的事實(IS/IS NOT)，通過驗證才能確認為真因。',
        'q1-ppa': 'RPN是風險管理的量化工具，透過綜合評估風險的嚴重性、發生可能性與被檢測的難易度，來客觀地排出風險的優先級。',
        'q2-ppa': 'Plan B (應變行動) 的目的是，當風險不幸真的發生時，能有預案來降低其造成的損害或衝擊。準備備用零件就是典型的Plan B。',
        'q1-da': 'Musts是決策的硬性門檻，任何選項若不滿足Musts，無論在Wants上得分多高，都應直接淘汰，這能有效率地縮小選擇範圍。',
        'q2-da': '不同的決策標準其重要性也不同。設定權重是為了讓最終的總分能真實反映出我們對不同標準的重視程度。',
        'q1-ca': 'IDEA框架的第一步是從洞察(Insight)開始，這需要我們深入使用者情境，用同理心去感受他們的痛點與爽點，這是所有創新的源頭。',
        'q2-ca': 'SCAMPER是一個腦力激盪的檢查表，C代表Combine(結合)，鼓勵我們思考能否將不同的事物、功能或點子結合在一起，創造出新的價值。'
    };

    function submitQuiz(type) {
        const quizContainer = document.getElementById(`quiz-${type}`);
        const questions = quizContainer.querySelectorAll('div[data-correct]');
        let score = 0;
        
        questions.forEach((question, index) => {
            const qName = `q${index + 1}-${type}`;
            const selectedOption = question.querySelector(`input[name="${qName}"]:checked`);
            const feedbackEl = question.querySelector('.quiz-feedback');
            const correctAnswer = question.dataset.correct;

            feedbackEl.classList.remove('hidden', 'feedback-correct', 'feedback-incorrect');

            if (selectedOption) {
                if (selectedOption.value === correctAnswer) {
                    score++;
                    feedbackEl.innerHTML = `✅ <strong>答對了！</strong> ${quizExplanations[qName]}`;
                    feedbackEl.classList.add('feedback-correct');
                } else {
                    feedbackEl.innerHTML = `❌ <strong>答錯了。</strong>正確答案是 (${correctAnswer.toUpperCase()})。<br>${quizExplanations[qName]}`;
                    feedbackEl.classList.add('feedback-incorrect');
                }
            } else {
                feedbackEl.innerHTML = `<strong>您未選擇答案。</strong>正確答案是 (${correctAnswer.toUpperCase()})。<br>${quizExplanations[qName]}`;
                feedbackEl.classList.add('feedback-incorrect');
            }
        });

        const scoreEl = document.getElementById(`score-${type}`);
        scoreEl.textContent = `您的得分: ${score} / ${questions.length}`;
    }

</script>

</body>
</html>
