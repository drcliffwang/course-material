<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé©…å‹•çš„ç²¾å¯¦å·¥å» ï¼šäº’å‹•å¼ç­–ç•¥è—åœ– (Geminiæ•´åˆç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8f9fa; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 45vh; }
        @media (min-width: 768px) { .chart-container { height: 350px; max-height: 40vh; } }
        .nav-tab-active { border-color: #0d6efd; color: #0d6efd; background-color: #e7f1ff; }
        .nav-tab-inactive { border-color: transparent; color: #495057; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .section-fade-in { animation: fadeIn 0.6s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .card-hover { transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #0d6efd; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .gemini-output { white-space: pre-wrap; background-color: #ffffff; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem; max-height: 400px; overflow-y: auto; }
        #toast-message { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #198754; color: white; padding: 1rem 1.5rem; border-radius: 0.5rem; transition: bottom 0.5s ease-in-out; z-index: 100; }
        #toast-message.error { background-color: #dc3545; }
        #toast-message.show { bottom: 20px; }
    </style>
</head>
<body class="text-gray-800">

    <div id="toast-message"></div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-3">AIé©…å‹•çš„ç²¾å¯¦å·¥å» </h1>
            <p class="text-lg md:text-xl text-blue-700 font-semibold">å°ç£æ©Ÿæ¢°é›¶çµ„ä»¶ç”¢æ¥­çš„äº’å‹•å¼ç­–ç•¥è—åœ–</p>
            <p class="max-w-3xl mx-auto mt-4 text-gray-600">
                æœ¬è—åœ–æ—¨åœ¨é—¡è¿°ç²¾å¯¦ç®¡ç†å¦‚ä½•èˆ‡AIæ·±åº¦èåˆã€‚å‚³çµ±ç²¾å¯¦æ“…é•·æ¶ˆé™¤ã€Œå¯è¦‹æµªè²»ã€ï¼Œè€ŒAIå‰‡èƒ½æŒ–æ˜éš±è—åœ¨æ•¸æ“šä¸­çš„ã€Œä¸å¯è¦‹æµªè²»ã€ã€‚è«‹é€éä¸‹æ–¹äº’å‹•æ¨¡çµ„ï¼Œæ¢ç´¢AIå¦‚ä½•è³¦èƒ½ç²¾å¯¦çš„æ¯ä¸€å€‹ç’°ç¯€ï¼Œå°‡æ‚¨çš„å·¥å» å¾ã€Œå¯è¦–åŒ–ã€æ¨å‘ã€Œå¯é æ¸¬åŒ–ã€èˆ‡ã€Œè‡ªä¸»å„ªåŒ–ã€ã€‚
            </p>
        </header>

        <nav class="mb-10 bg-white p-2 rounded-xl shadow-md sticky top-4 z-20">
            <ul class="flex flex-wrap justify-center gap-2 md:gap-4">
                <li><button class="nav-tab text-sm md:text-base font-semibold px-4 py-2.5 rounded-lg border-b-2 transition-all duration-200" data-target="strategy">ğŸ¯ ç­–ç•¥æ¡†æ¶</button></li>
                <li><button class="nav-tab text-sm md:text-base font-semibold px-4 py-2.5 rounded-lg border-b-2 transition-all duration-200" data-target="toolbox">ğŸ› ï¸ å¯¦è¸å·¥å…·ç®±</button></li>
                <li><button class="nav-tab text-sm md:text-base font-semibold px-4 py-2.5 rounded-lg border-b-2 transition-all duration-200" data-target="blueprint">ğŸ—ºï¸ ç”¢æ¥­è—åœ–</button></li>
                <li><button class="nav-tab text-sm md:text-base font-semibold px-4 py-2.5 rounded-lg border-b-2 transition-all duration-200" data-target="guide">ğŸ“– è³¦èƒ½æŒ‡å—</button></li>
            </ul>
        </nav>

        <main>
            <!-- Section 1: Strategy Framework -->
            <section id="strategy" class="content-section">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">ç­–ç•¥æ¡†æ¶ï¼šAIè³¦èƒ½ç²¾å¯¦äº”å¤§åŸå‰‡</h2>
                    <p class="max-w-3xl mx-auto mt-3 text-gray-600">ç²¾å¯¦ç®¡ç†çš„äº”å¤§åŸå‰‡æ§‹æˆä¸€å€‹æŒçºŒå‰µé€ åƒ¹å€¼çš„å¾ªç’°ã€‚æœ¬ç¯€å°‡å±•ç¤ºAIå¦‚ä½•åœ¨æ¯å€‹åŸå‰‡ä¸­æ‰®æ¼”å‚¬åŒ–åŠ‘çš„è§’è‰²ï¼Œå°‡å‚³çµ±æ–¹æ³•æå‡è‡³å…¨æ–°ç¶­åº¦ã€‚é»æ“Šä¸‹æ–¹ä»»ä¸€åŸå‰‡ï¼ŒæŸ¥çœ‹AIçš„å…·é«”æ‡‰ç”¨åŠå…¶å°æ¶ˆé™¤æµªè²»çš„å½±éŸ¿ã€‚</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8 text-center">
                    <button class="lean-principle-btn p-4 bg-white rounded-xl shadow-sm card-hover" data-principle="value">
                        <div class="text-4xl mb-2">ğŸ’</div>
                        <h3 class="font-bold text-blue-800">1. å®šç¾©åƒ¹å€¼</h3>
                        <p class="text-xs text-gray-500">Specify Value</p>
                    </button>
                    <button class="lean-principle-btn p-4 bg-white rounded-xl shadow-sm card-hover" data-principle="stream">
                        <div class="text-4xl mb-2">ğŸŒŠ</div>
                        <h3 class="font-bold text-blue-800">2. ç¹ªè£½åƒ¹å€¼æµ</h3>
                        <p class="text-xs text-gray-500">Map Value Stream</p>
                    </button>
                    <button class="lean-principle-btn p-4 bg-white rounded-xl shadow-sm card-hover" data-principle="flow">
                        <div class="text-4xl mb-2">âš¡</div>
                        <h3 class="font-bold text-blue-800">3. å‰µé€ æš¢æµ</h3>
                        <p class="text-xs text-gray-500">Create Flow</p>
                    </button>
                    <button class="lean-principle-btn p-4 bg-white rounded-xl shadow-sm card-hover" data-principle="pull">
                        <div class="text-4xl mb-2">ğŸ£</div>
                        <h3 class="font-bold text-blue-800">4. å»ºç«‹å¾Œæ‹‰</h3>
                        <p class="text-xs text-gray-500">Establish Pull</p>
                    </button>
                    <button class="lean-principle-btn p-4 bg-white rounded-xl shadow-sm card-hover" data-principle="perfection">
                        <div class="text-4xl mb-2">ğŸ¯</div>
                        <h3 class="font-bold text-blue-800">5. è¿½æ±‚å®Œå–„</h3>
                        <p class="text-xs text-gray-500">Seek Perfection</p>
                    </button>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 id="principle-title" class="text-xl font-bold text-gray-900 mb-2 text-center">AIå°æ¶ˆé™¤ä¸ƒå¤§æµªè²»çš„å½±éŸ¿åŠ›åˆ†æ</h3>
                    <div id="principle-details" class="mb-6 text-center text-gray-600 min-h-[4rem] max-w-2xl mx-auto">é»æ“Šä¸Šæ–¹ä»»ä¸€åŸå‰‡ä»¥æŸ¥çœ‹è©³ç´°èªªæ˜èˆ‡å°æ‡‰çš„æµªè²»æ¶ˆé™¤æ•ˆç›Šã€‚</div>
                    <div class="chart-container">
                        <canvas id="wasteChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Section 2: Toolbox -->
            <section id="toolbox" class="content-section hidden">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">å¯¦è¸å·¥å…·ç®±ï¼šAIå¼·åŒ–å·¥æ¥­å·¥ç¨‹</h2>
                    <p class="max-w-3xl mx-auto mt-3 text-gray-600">æœ¬ç¯€ç‚ºå·¥ç¨‹å¸«æä¾›å¯¦ç”¨å·¥å…·ï¼Œå±•ç¤ºAIå¦‚ä½•å°‡ç¶“å…¸çš„å·¥æ¥­å·¥ç¨‹ï¼ˆIEï¼‰æ‰‹æ³•å¾å®šæ€§ç¶“é©—å‡ç´šç‚ºå®šé‡ç§‘å­¸ï¼Œä¸¦å°‡åƒ¹å€¼æµåˆ†æè½‰è®Šç‚ºå‹•æ…‹çš„æ•¸ä½åŒ–ç®¡ç†ã€‚</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">ä»¥AIé‡å¡‘IEä¸ƒå¤§æ‰‹æ³•</h3>
                    <div id="ie-tools-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                        <!-- IE Tools Cards will be injected here by JS -->
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">âœ¨ AIæ”¹å–„ææ¡ˆç”Ÿæˆå™¨</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="kaizen-problem" class="block text-sm font-medium text-gray-700">æè¿°æ‚¨åœ¨ç”¢ç·šä¸Šé‡åˆ°çš„å•é¡Œæˆ–ç—›é»ï¼š</label>
                            <textarea id="kaizen-problem" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="ä¾‹å¦‚ï¼šCNCåŠ å·¥å¾Œçš„é›¶ä»¶è¡¨é¢å¸¸æœ‰åˆ®ç—•ï¼Œå°è‡´ä¸è‰¯ç‡åé«˜ã€‚"></textarea>
                        </div>
                        <div class="flex items-center justify-end">
                            <button id="generate-kaizen-ideas" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <span class="gemini-button-text">âœ¨ ç”¢ç”Ÿæ”¹å–„é»å­</span>
                                <div class="loader hidden ml-2"></div>
                            </button>
                        </div>
                    </div>
                    <div id="kaizen-output" class="gemini-output hidden"></div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">æ•¸æ“šé©…å‹•çš„åƒ¹å€¼æµï¼šVSM-AIæ•´åˆæŒ‡å—</h3>
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="w-full md:w-1/2">
                           <div id="vsm-steps" class="space-y-3">
                               <!-- VSM Steps will be injected here -->
                           </div>
                        </div>
                        <div class="w-full md:w-1/2">
                            <div id="vsm-step-description" class="text-gray-700 mb-4 p-5 bg-gray-50 rounded-lg min-h-[120px] border border-gray-200">é»æ“Šå·¦å´æ­¥é©Ÿï¼ŒæŸ¥çœ‹è©³ç´°èªªæ˜ã€‚</div>
                            <div class="chart-container" style="height:250px; max-height: 250px;">
                                <canvas id="vsmChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Blueprint -->
            <section id="blueprint" class="content-section hidden">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">ç”¢æ¥­è—åœ–ï¼šAIè½åœ°å¯¦è¸æ¡ˆä¾‹</h2>
                    <p class="max-w-3xl mx-auto mt-3 text-gray-600">æœ¬ç¯€å±•ç¤ºAIåœ¨å°ç£æ©Ÿæ¢°é›¶çµ„ä»¶ç”¢æ¥­çš„å…·é«”æ‡‰ç”¨æ¡ˆä¾‹ï¼Œå¾å“è³ªã€ç¶­è­·åˆ°è¨­è¨ˆï¼Œçœ‹è¦‹æŠ€è¡“å¦‚ä½•è½‰åŒ–ç‚ºçœŸå¯¦çš„å•†æ¥­åƒ¹å€¼èˆ‡ç«¶çˆ­å„ªå‹¢ã€‚</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg">
                    <div class="border-b border-gray-200">
                        <nav class="flex flex-wrap -mb-px p-2" aria-label="Tabs">
                            <button class="blueprint-tab w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm md:text-base" data-bptarget="quality">ğŸ”¬ æ™ºæ…§å“è³ª</button>
                            <button class="blueprint-tab w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm md:text-base" data-bptarget="proactive">ğŸ­ é æ‡‰å¼å·¥å» </button>
                            <button class="blueprint-tab w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm md:text-base" data-bptarget="generative">ğŸ’¡ ç”Ÿæˆå¼è¨­è¨ˆ</button>
                        </nav>
                    </div>
                    <div class="p-6">
                        <div id="quality" class="blueprint-content">
                            <h3 class="text-lg font-bold text-gray-900 mb-2">AIé©…å‹•çš„è‡ªå‹•åŒ–æª¢æ¸¬ (AOI+AI)</h3>
                            <p class="text-gray-600 mb-4">é€éæ·±åº¦å­¸ç¿’ï¼ŒAIè¦–è¦ºæª¢æ¸¬èƒ½è­˜åˆ¥å‚³çµ±AOIé›£ä»¥åˆ¤æ–·çš„è¤‡é›œç‘•ç–µï¼ˆå¦‚é‘„ä»¶ç´°å¾®è£‚ç´‹ï¼‰ï¼Œä¸¦å¤§å¹…é™ä½èª¤å ±ç‡ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒèƒ½å°‡ç‘•ç–µæ•¸æ“šå›é¥‹è‡³è£½ç¨‹ï¼Œå¯¦ç¾å¾ã€Œæª¢æ¸¬ã€åˆ°ã€Œé é˜²ã€çš„é–‰ç’°ç®¡ç†ã€‚</p>
                            <div class="chart-container">
                                <canvas id="qualityChart"></canvas>
                            </div>
                        </div>
                        <div id="proactive" class="blueprint-content hidden">
                            <h3 class="text-lg font-bold text-gray-900 mb-2">é æ¸¬æ€§ç¶­è­· (PdM) èˆ‡æ™ºæ…§æ’ç¨‹</h3>
                            <p class="text-gray-600 mb-4">AIåˆ†ææ©Ÿå°æ„Ÿæ¸¬å™¨æ•¸æ“šï¼ˆå¦‚éœ‡å‹•ã€æº«åº¦ï¼‰ï¼Œé æ¸¬æ½›åœ¨æ•…éšœèˆ‡å‰©é¤˜å£½å‘½(RUL)ï¼Œå°‡éè¨ˆç•«åœæ©Ÿè½‰ç‚ºè¨ˆç•«ç¶­ä¿®ã€‚æ­¤é æ¸¬çµæœé€²ä¸€æ­¥å„ªåŒ–ç”Ÿç”¢æ’ç¨‹ï¼Œæ‰“é€ åæ‡‰æ•æ·çš„ã€Œé æ‡‰å¼å·¥å» ã€ã€‚</p>
                            <div class="chart-container">
                                <canvas id="pdmChart"></canvas>
                            </div>
                        </div>
                        <div id="generative" class="blueprint-content hidden">
                            <h3 class="text-lg font-bold text-gray-900 mb-2">AIåœ¨é›¶çµ„ä»¶è¨­è¨ˆèˆ‡ææ–™ç§‘å­¸çš„æ‡‰ç”¨</h3>
                            <p class="text-gray-600 mb-4">ç”Ÿæˆå¼è¨­è¨ˆç”±AIè‡ªä¸»æ¢ç´¢æ•¸åƒç¨®è¨­è¨ˆæ–¹æ¡ˆï¼Œå‰µé€ å‡ºè¶…è¶Šäººé¡æƒ³åƒçš„è¼•é‡åŒ–ã€é«˜å¼·åº¦ä»¿ç”Ÿçµæ§‹ï¼Œå¾æºé ­é¡›è¦†ç”¢å“çš„æ€§èƒ½èˆ‡æˆæœ¬ã€‚</p>
                            <div class="flex flex-col md:flex-row gap-6 items-stretch justify-center text-center">
                                <div class="w-full md:w-1/2 p-5 border border-gray-200 rounded-lg flex flex-col justify-between">
                                    <h4 class="font-bold text-gray-700 mb-2">å‚³çµ±è¨­è¨ˆ</h4>
                                    <div class="w-32 h-32 bg-gray-300 mx-auto flex items-center justify-center font-mono text-gray-500 rounded-lg">[8 é›¶ä»¶]</div>
                                    <p class="mt-3 text-sm text-gray-600">å¤šé›¶ä»¶çµ„è£ï¼Œçµæ§‹å†—é¤˜ï¼Œé–‹ç™¼é€±æœŸé•·ã€‚</p>
                                </div>
                                <div class="w-full md:w-1/2 p-5 border-2 border-blue-500 bg-blue-50 rounded-lg flex flex-col justify-between">
                                    <h4 class="font-bold text-blue-800 mb-2">ç”Ÿæˆå¼è¨­è¨ˆ (AI)</h4>
                                    <div class="w-32 h-32 bg-blue-200 mx-auto flex items-center justify-center font-mono text-blue-700 rounded-lg" style="clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);">[1 é›¶ä»¶]</div>
                                    <p class="mt-3 text-sm text-blue-700 font-semibold">å–®ä¸€éƒ¨ä»¶ï¼Œé‡é‡-40%ï¼Œå¼·åº¦+20%ï¼ŒåŠ é€Ÿå‰µæ–°ã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Guide -->
            <section id="guide" class="content-section hidden">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">è³¦èƒ½æŒ‡å—ï¼šäººæ©Ÿå”ä½œçš„æœªä¾†</h2>
                    <p class="max-w-3xl mx-auto mt-3 text-gray-600">AIçš„æˆåŠŸå°å…¥ï¼Œçµ‚ç©¶å–æ±ºæ–¼ã€Œäººã€ã€‚æœ¬ç¯€ç‚ºå·¥ç¨‹å¸«èˆ‡ç®¡ç†è€…æä¾›å…·é«”çš„è¡Œå‹•æŒ‡å—èˆ‡ç­–ç•¥åŠ‡æœ¬ï¼Œä¸¦æ¢è¨å¦‚ä½•å»ºç«‹ä»¥äººç‚ºæœ¬ã€èˆ‡AIå…±å­¸çš„å¥åº·æ–‡åŒ–ã€‚</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">ğŸ‘¨â€ğŸ’» å·¥ç¨‹å¸«çš„AIå‰¯é§• (Copilot)</h3>
                        <p class="text-gray-600 mb-4">æŒæ¡èˆ‡å¤§å‹èªè¨€æ¨¡å‹(LLM)æºé€šçš„ã€Œæç¤ºå·¥ç¨‹ã€æŠ€å·§æ˜¯æå‡ç”Ÿç”¢åŠ›çš„é—œéµã€‚åˆ©ç”¨RTFæ¡†æ¶ï¼ˆè§’è‰²ã€ä»»å‹™ã€æ ¼å¼ï¼‰ä¾†ç²å–é«˜å“è³ªçš„å›ç­”ã€‚</p>
                        <div id="accordion-container" class="space-y-3">
                            <!-- Accordion items injected here -->
                        </div>
                         <div class="bg-white p-6 rounded-xl shadow-lg mt-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6">âœ¨ AIæ¨™æº–ä½œæ¥­ç¨‹åº(SOP)è‰æ“¬åŠ©ç†</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="sop-task" class="block text-sm font-medium text-gray-700">ä½œæ¥­åç¨±</label>
                                    <input type="text" id="sop-task" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="ä¾‹å¦‚ï¼šCNCæ©Ÿå°é–‹æ©Ÿæª¢æŸ¥">
                                </div>
                                <div>
                                    <label for="sop-steps" class="block text-sm font-medium text-gray-700">é—œéµæ­¥é©Ÿ (è«‹æ¢åˆ—å¼è¼¸å…¥)</label>
                                    <textarea id="sop-steps" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="1. ç¢ºèªç·Šæ€¥åœæ­¢æŒ‰éˆ•å·²å¾©æ­¸ã€‚&#10;2. é–‹å•Ÿç¸½é›»æºã€‚&#10;3. æª¢æŸ¥æ²¹å£“ã€æ°£å£“éŒ¶æ•¸å€¼ã€‚"></textarea>
                                </div>
                                <div>
                                    <label for="sop-safety" class="block text-sm font-medium text-gray-700">å®‰å…¨æ³¨æ„äº‹é … (è«‹æ¢åˆ—å¼è¼¸å…¥)</label>
                                    <textarea id="sop-safety" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="- æ“ä½œæ™‚å‹™å¿…é…æˆ´è­·ç›®é¡ã€‚&#10;- æ¸…æ½”æ©Ÿå°æ™‚éœ€å…ˆæ–·é›»ã€‚"></textarea>
                                </div>
                                <div class="flex items-center justify-end">
                                    <button id="generate-sop" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                                        <span class="gemini-button-text">âœ¨ ç”ŸæˆSOPè‰ç¨¿</span>
                                        <div class="loader hidden ml-2"></div>
                                    </button>
                                </div>
                            </div>
                            <div id="sop-output-container" class="hidden mt-4">
                                <div id="sop-output" class="gemini-output"></div>
                                <button id="copy-sop" class="mt-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50">è¤‡è£½å…§å®¹</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">ğŸ“ˆ ç®¡ç†è€…çš„AIåŠ‡æœ¬ (Playbook)</h3>
                         <p class="text-gray-600 mb-4">ç®¡ç†è€…éœ€å»ºç«‹æ¸…æ™°çš„å•†æ¥­æ¡ˆä¾‹ã€åˆ†éšæ®µçš„å°å…¥è·¯ç·šåœ–ï¼Œä¸¦åŸ¹è‚²æ•¸æ“šé©…å‹•çš„æ–‡åŒ–ï¼Œä»¥é¿å…ã€Œè©¦é»ç…‰ç„ã€ä¸¦ç¢ºä¿æŠ•è³‡å›å ±ã€‚</p>
                        <div class="chart-container mb-6" style="height:250px; max-height: 250px;">
                            <canvas id="roiChart"></canvas>
                        </div>
                         <div>
                            <h4 class="font-semibold text-center mb-3">å››éšæ®µAIå°å…¥è·¯ç·šåœ–</h4>
                            <div class="relative text-sm pl-6">
                                <div class="absolute left-0 top-0 bottom-0 w-0.5 bg-gray-200 ml-1.5"></div>
                                <!-- Timeline items injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-12 pt-8 border-t border-gray-200">
            <p class="text-sm text-gray-500">&copy; 2024 AIé©…å‹•çš„ç²¾å¯¦å·¥å» ç­–ç•¥è—åœ–ã€‚å°ˆç‚ºèª²ç¨‹è¨­è¨ˆï¼Œæ•´åˆè‡ªå­¸è¡“èˆ‡ç”¢æ¥­å ±å‘Šã€‚</p>
        </footer>
    </div>

<script>
    // --- Global API Key Management ---
    let userApiKey = '';
    let apiProvider = 'gemini';
    let userEndpointUrl = '';
    
    // This function will be called by the main page's script via URL parameters
    function loadApiKey(key, provider, endpoint) {
        userApiKey = key;
        apiProvider = provider;
        if (endpoint) {
            userEndpointUrl = endpoint;
        }
        
        sessionStorage.setItem('userApiKey', userApiKey);
        sessionStorage.setItem('apiProvider', apiProvider);
        if (userEndpointUrl) {
            sessionStorage.setItem('userEndpointUrl', userEndpointUrl);
        }

        showToast(`API é‡‘é‘°å·²å¾ä¸»èª²ç¨‹é é¢è¼‰å…¥ï¼`);
    }


document.addEventListener('DOMContentLoaded', () => {

    const appData = {
        principles: {
            value: { 
                title: 'å®šç¾©åƒ¹å€¼', 
                details: 'é€éç”Ÿæˆå¼AIèˆ‡NLPåˆ†æé¡§å®¢å›é¥‹ï¼Œç²¾æº–é æ¸¬éœ€æ±‚ï¼Œå¾æºé ­å‰µé€ æ›´é«˜åƒ¹å€¼ï¼Œä¸¦åˆ©ç”¨ç”Ÿæˆå¼è¨­è¨ˆæ‰“é€ å‰µæ–°ç”¢å“ã€‚',
                wastes: { 'ä¸è‰¯/é‡å·¥': 5, 'ç”Ÿç”¢éå‰©': 30, 'ç­‰å¾…': 5, 'æ¬é‹': 5, 'åŠ å·¥': 35, 'åº«å­˜': 15, 'å‹•ä½œ': 5 } 
            },
            stream: { 
                title: 'ç¹ªè£½åƒ¹å€¼æµ', 
                details: 'åˆ©ç”¨æµç¨‹æ¢å‹˜(Process Mining)è‡ªå‹•ã€å®¢è§€åœ°ç¹ªè£½çœŸå¯¦æµç¨‹ï¼Œç²¾æº–é‡åŒ–ç“¶é ¸èˆ‡åœ¨è£½å“(WIP)ç­‰å€™çš„æµªè²»ã€‚',
                wastes: { 'ä¸è‰¯/é‡å·¥': 5, 'ç”Ÿç”¢éå‰©': 10, 'ç­‰å¾…': 40, 'æ¬é‹': 10, 'åŠ å·¥': 5, 'åº«å­˜': 30, 'å‹•ä½œ': 0 } 
            },
            flow: { 
                title: 'å‰µé€ æš¢æµ', 
                details: 'ä»¥AIæ’ç¨‹å„ªåŒ–èˆ‡é æ¸¬æ€§ç¶­è­·ï¼Œæ¶ˆé™¤åœæ»¯èˆ‡éè¨ˆç•«æ€§åœæ©Ÿï¼Œæœ€å¤§åŒ–ç”¢ç·šæµå‹•æ•ˆç‡ã€‚',
                wastes: { 'ä¸è‰¯/é‡å·¥': 10, 'ç”Ÿç”¢éå‰©': 5, 'ç­‰å¾…': 45, 'æ¬é‹': 5, 'åŠ å·¥': 15, 'åº«å­˜': 15, 'å‹•ä½œ': 0 } 
            },
            pull: { 
                title: 'å»ºç«‹å¾Œæ‹‰', 
                details: 'è—‰ç”±AIç²¾æº–é æ¸¬å¸‚å ´éœ€æ±‚èˆ‡å„ªåŒ–åº«å­˜ï¼Œå¯¦ç¾æ›´æ•æ·çš„å¾Œæ‹‰å¼ç”Ÿç”¢(Pull System)ï¼Œæ¶ˆé™¤ç”Ÿç”¢éå‰©ã€‚',
                wastes: { 'ä¸è‰¯/é‡å·¥': 5, 'ç”Ÿç”¢éå‰©': 45, 'ç­‰å¾…': 10, 'æ¬é‹': 5, 'åŠ å·¥': 5, 'åº«å­˜': 25, 'å‹•ä½œ': 0 } 
            },
            perfection: { 
                title: 'è¿½æ±‚å®Œå–„', 
                details: 'AIé©…å‹•çš„æ ¹æœ¬åŸå› åˆ†æ(RCA)èƒ½ç™¼æ˜æ·±å±¤æ¬¡çš„å› æœé—œä¿‚ï¼Œä½¿æŒçºŒæ”¹å–„(Kaizen)æ›´æœ‰æ•ˆï¼Œå¾æºé ­æœçµ•ä¸è‰¯å“ã€‚',
                wastes: { 'ä¸è‰¯/é‡å·¥': 50, 'ç”Ÿç”¢éå‰©': 5, 'ç­‰å¾…': 5, 'æ¬é‹': 5, 'åŠ å·¥': 15, 'åº«å­˜': 5, 'å‹•ä½œ': 15 } 
            }
        },
        ieTools: [
            { name: 'é˜²å‘†æ³• (Poka-Yoke)', traditional: 'ç‰©ç†æ²»å…·ã€å…‰é›»æ„Ÿæ¸¬ï¼Œç¼ºä¹å½ˆæ€§ã€‚', ai: 'ã€æ•¸ä½é˜²å‘†ã€‘åˆ©ç”¨é›»è…¦è¦–è¦ºå³æ™‚ç›£æ§ï¼Œç¢ºä¿æ“ä½œå“¡ä½¿ç”¨æ­£ç¢ºå·¥å…·èˆ‡å·¥ä»¶ï¼Œå½ˆæ€§é«˜ã€‚' },
            { name: 'å‹•æ”¹æ³• (ECRS)', traditional: 'ä¾è³´ç¶“é©—é€²è¡Œæµç¨‹åˆªã€ä½µã€é‡ã€ç°¡ã€‚', ai: 'ã€AIæ¨¡æ“¬å„ªåŒ–ã€‘åœ¨æ•¸ä½åˆ†èº«ä¸­ï¼ŒAIç”Ÿæˆä¸¦è©•ä¼°æ•¸åƒç¨®ä½ˆå±€èˆ‡æµç¨‹çµ„åˆï¼Œæ‰¾å‡ºæœ€ä½³æ–¹æ¡ˆã€‚' },
            { name: 'æµç¨‹æ³• (Process Chart)', traditional: 'æ‰‹å·¥ç¹ªè£½æµç¨‹åœ–ï¼Œéœæ…‹ä¸”å¯èƒ½èˆ‡ç¾å¯¦è„«ç¯€ã€‚', ai: 'ã€æµç¨‹æ¢å‹˜ã€‘è‡ªå‹•å¾ç³»çµ±æ—¥èªŒç”Ÿæˆå®¢è§€ã€å‹•æ…‹çš„æ•¸ä½æµç¨‹åœ–ï¼Œåæ˜ çœŸå¯¦ç‹€æ³ã€‚' },
            { name: 'é€£åˆæ³• (Man-Machine)', traditional: 'æ‰‹å·¥ç¹ªè£½äººæ©Ÿåœ–ï¼Œåˆ†æäººæ©Ÿé–’ç½®æ™‚é–“ã€‚', ai: 'ã€AIè³‡æºèª¿åº¦ã€‘AIå³æ™‚ç›£æ§å¤šæ©Ÿå¤šäººç‹€æ…‹ï¼Œå‹•æ…‹åˆ†é…ä»»å‹™ï¼Œæœ€å¤§åŒ–æ•´é«”ç¨¼å‹•ç‡ã€‚' },
            { name: '3x5 Whyæ³•', traditional: 'åè¦†æå•æ¢ç©¶åŸå› ï¼Œæ·±åº¦å—é™æ–¼åœ˜éšŠçŸ¥è­˜ã€‚', ai: 'ã€AIæ ¹æœ¬åŸå› åˆ†æã€‘AIåˆ†ææ­·å²æ•¸æ“šåº«ï¼Œæ‰¾å‡ºå•é¡ŒèƒŒå¾Œéš±è—çš„ã€è·¨ç¶­åº¦çš„çµ±è¨ˆç›¸é—œæ€§ã€‚' },
            { name: 'é›™æ‰‹æ³• (Two-Handed)', traditional: 'è§€å¯Ÿè¨˜éŒ„é›™æ‰‹å‹•ä½œï¼Œåˆ†æç¹ç‘£ä¸”ä¾è³´å°ˆå®¶ã€‚', ai: 'ã€AIäººå› åˆ†æã€‘é€éæ”å½±æ©Ÿèˆ‡å§¿æ…‹ä¼°è¨ˆï¼ŒAIè‡ªå‹•é€²è¡Œå‹•ä½œåˆ†æèˆ‡äººå› å·¥ç¨‹é¢¨éšªè©•ä¼°ã€‚' },
            { name: 'æŠ½æŸ¥æ³• (Sampling)', traditional: 'éš¨æ©ŸæŠ½æ¨£è§€å¯Ÿï¼Œå¯èƒ½éŒ¯éé—œéµäº‹ä»¶ã€‚', ai: 'ã€æ™ºæ…§å…¨æª¢ã€‘AIè¦–è¦ºæª¢æ¸¬å¯å¯¦ç¾100%å…¨æª¢ï¼Œå–ä»£æŠ½æ¨£ï¼›æˆ–é€éç•°å¸¸åµæ¸¬å¼•å°åˆ†æã€‚' }
        ],
        vsmSteps: [
            { name: '1. å¥ å®šæ•¸æ“šåŸºç¤', description: 'é¦–è¦ä»»å‹™æ˜¯æ‰“é€šMESã€ERPã€IoTç­‰æ•¸æ“šå­¤å³¶ï¼Œä¸¦å»ºç«‹æ•¸æ“šæ²»ç†æ¡†æ¶ï¼Œç¢ºä¿æ•¸æ“šçš„æº–ç¢ºæ€§èˆ‡ä¸€è‡´æ€§ã€‚' },
            { name: '2. æµç¨‹æŒ–æ˜ç”Ÿæˆç¾æ³åœ–', description: 'åˆ©ç”¨æµç¨‹æ¢å‹˜æŠ€è¡“ï¼Œè‡ªå‹•å¾ç³»çµ±æ—¥èªŒä¸­æå–æ•¸æ“šï¼Œç”Ÿæˆå®¢è§€ã€çœŸå¯¦çš„ç¾æ³åƒ¹å€¼æµåœ–(VSM)ï¼Œè‡ªå‹•å‘ˆç¾æµç¨‹è®Šç•°ã€‚' },
            { name: '3. é‡åŒ–æµªè²»èˆ‡AIæ ¹æœ¬åŸå› åˆ†æ', description: 'åœ¨AIç”Ÿæˆçš„VSMä¸Šï¼Œç“¶é ¸èˆ‡ç­‰å¾…æ™‚é–“ä¸€ç›®äº†ç„¶ã€‚å†åˆ©ç”¨AIé€²è¡Œæ ¹æœ¬åŸå› åˆ†æ(RCA)ï¼Œæ‰¾å‡ºé€ æˆå»¶é²çš„æ ¹æºã€‚' },
            { name: '4. è¨­è¨ˆèˆ‡æ¨¡æ“¬æœªä¾†åœ–', description: 'åŸºæ–¼æ´å¯Ÿè¨­è¨ˆæ”¹å–„æ–¹æ¡ˆï¼Œä¸¦åœ¨æ•¸ä½åˆ†èº«ä¸­é€²è¡Œæ¨¡æ“¬ï¼Œé æ¸¬æ”¹å–„æ•ˆç›Šã€é‡åŒ–ROIï¼Œé¿å…æ˜‚è²´çš„å¯¦é«”è©¦èª¤ã€‚' }
        ],
        prompts: [
            { title: 'æ ¹æœ¬åŸå› åˆ†æ (RCA)', content: "æ‰®æ¼”ä¸€ä½ç¶“é©—è±å¯Œçš„å“ä¿å°ˆå®¶ã€‚æˆ‘å€‘åœ¨[ç”¢å“åç¨±]çš„[è£½ç¨‹åç¨±]ä¸­é‡åˆ°äº†[å…·é«”å•é¡Œæè¿°]çš„å•é¡Œã€‚å·²çŸ¥æ½›åœ¨å½±éŸ¿å› ç´ åŒ…å«ï¼š[å› ç´ 1], [å› ç´ 2], [å› ç´ 3]...ã€‚è«‹æ ¹æ“šé€™äº›è³‡è¨Šï¼Œ(1) å‰µå»ºä¸€å€‹é­šéª¨åœ–ï¼ˆçŸ³å·åœ–ï¼‰ä¾†çµ„ç¹”é€™äº›å¯èƒ½çš„åŸå› ã€‚(2) é‡å°æœ€é‡è¦çš„2-3å€‹åŸå› ï¼Œè¨­è¨ˆä¸€å¥—ã€Œ5å€‹ç‚ºä»€éº¼ã€çš„æå•æ¸…å–®ï¼Œä»¥å¼•å°æˆ‘å€‘æ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚è«‹ä»¥ç¹é«”ä¸­æ–‡çš„å°ˆæ¥­è¡“èªå›ç­”ã€‚" },
            { title: 'æ¨™æº–ä½œæ¥­ç¨‹åº (SOP) è‰æ“¬', content: "æ‰®æ¼”ä¸€ä½å°ˆæ¥­çš„æŠ€è¡“æ–‡ä»¶æ’°å¯«è€…ã€‚è«‹ç‚ºæˆ‘å€‘çš„[æ©Ÿå°åç¨±/å‹è™Ÿ]è‰æ“¬ä¸€ä»½ã€Œ[ä½œæ¥­åç¨±]ã€çš„æ¨™æº–ä½œæ¥­ç¨‹åº(SOP)ã€‚é€™ä»½SOPçš„ç›®æ¨™è®€è€…æ˜¯æ–°é€²æ“ä½œå“¡ã€‚é—œéµæ­¥é©Ÿå¦‚ä¸‹ï¼š[æ­¥é©Ÿ1], [æ­¥é©Ÿ2], [æ­¥é©Ÿ3]...ã€‚è«‹ç¢ºä¿èªè¨€ç°¡æ½”æ˜ç­ï¼Œä¸¦åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä¸€å€‹ã€Œå®‰å…¨æ³¨æ„äº‹é …ã€çš„ç« ç¯€ã€‚è«‹ä»¥æ¢åˆ—å¼ç·¨è™Ÿæ ¼å¼å‘ˆç¾ã€‚" },
            { title: 'æ•¸æ“šåˆ†æèˆ‡è¦–è¦ºåŒ–', content: "æˆ‘å°‡æä¾›ä¸€å€‹CSVæ ¼å¼çš„ç”Ÿç”¢æ•¸æ“šé›†ã€‚æ¬„ä½åŒ…å«ï¼š[æ¬„ä½A], [æ¬„ä½B], [æ¬„ä½C]...ã€‚è«‹ä½¿ç”¨Pythonçš„pandaså’Œmatplotlibå‡½å¼åº«ï¼Œåˆ†æ[æ¬„ä½X]èˆ‡[æ¬„ä½Y]ä¹‹é–“çš„é—œä¿‚ã€‚è«‹(1) è¨ˆç®—å…©è€…çš„ç›¸é—œä¿‚æ•¸ã€‚(2) ç¹ªè£½ä¸€å€‹æ•£é»åœ–ä¾†è¦–è¦ºåŒ–é€™å€‹é—œä¿‚ã€‚(3) æ ¹æ“šçµæœï¼Œç”¨ä¸è¶…é100å­—çš„æ–‡å­—ç¸½çµä½ çš„ç™¼ç¾ã€‚" },
            { title: 'è…¦åŠ›æ¿€ç›ªèˆ‡æ”¹å–„ææ¡ˆ', content: "æˆ‘å€‘æ­£åœ¨é€²è¡Œä¸€å€‹é‡å°[æŸå€‹æµç¨‹ï¼Œå¦‚ï¼šå€‰åº«é ˜æ–™]çš„æ”¹å–„(Kaizen)æ´»å‹•ã€‚ç›®å‰çš„ç—›é»æ˜¯[ç—›é»æè¿°ï¼Œå¦‚ï¼šé ˜æ–™è€—æ™‚éé•·ã€å¸¸ç™¼ç”Ÿé ˜éŒ¯æ–™çš„æƒ…æ³]ã€‚è«‹ä½¿ç”¨SCAMPERæ³•ï¼ˆæ›¿ä»£ã€çµåˆã€èª¿æ•´ã€ä¿®æ”¹ã€æŒªä½œä»–ç”¨ã€æ¶ˆé™¤ã€é‡æ’ï¼‰ï¼Œé‡å°é€™å€‹æµç¨‹æå‡ºè‡³å°‘10å€‹å‰µæ–°çš„æ”¹å–„é»å­ã€‚" }
        ],
        roadmap: [
            { stage: 'éšæ®µä¸€ (1-3æœˆ): å®šç¾©èˆ‡è©•ä¼°', tasks: 'æˆç«‹è·¨è·èƒ½AIåœ˜éšŠã€è­˜åˆ¥é«˜åƒ¹å€¼å ´æ™¯ã€è©•ä¼°æ•¸æ“šæº–å‚™åº¦ã€‚' },
            { stage: 'éšæ®µäºŒ (3-6æœˆ): è©¦é»èˆ‡é©—è­‰', tasks: 'å¾å°è™•è‘—æ‰‹ã€å¿«é€Ÿå–å‹ï¼ˆå¦‚å–®ä¸€è¨­å‚™PdMï¼‰ï¼Œè­‰æ˜åƒ¹å€¼ã€‚' },
            { stage: 'éšæ®µä¸‰ (6-18æœˆ): æ“´å±•èˆ‡è¦æ¨¡åŒ–', tasks: 'å»ºç«‹å¯è¤‡è£½æ¨¡å¼ã€æŠ•è³‡å¹³å°åŒ–åŸºç¤è¨­æ–½ï¼ˆå¦‚MLOpsï¼‰ã€‚' },
            { stage: 'éšæ®µå›› (æŒçºŒ): è½‰å‹èˆ‡å‰µæ–°', tasks: 'è³¦èƒ½å…¨é«”å“¡å·¥ã€æ¢ç´¢å¾ã€ŒéŠ·å”®ç”¢å“ã€åˆ°ã€Œæä¾›æœå‹™ã€çš„æ–°å•†æ¥­æ¨¡å¼ã€‚' }
        ]
    };

    let charts = {};

    function init() {
        handleApiKeyTransfer(); // Check for API key in URL first
        setupNavigation();
        populateToolbox();
        populateVSMSteps();
        populateAccordion();
        populateRoadmap();
        createCharts();
        setupGeminiFeatures();
        
        switchTab('strategy');
        document.querySelector('.lean-principle-btn[data-principle="value"]').click();
        document.querySelector('.blueprint-tab[data-bptarget="quality"]').click();
        document.querySelector('.vsm-step-btn[data-index="0"]').click();
        document.querySelector('.accordion-toggle').click();
    }
    
    function handleApiKeyTransfer() {
        const params = new URLSearchParams(window.location.search);
        const apiKey = params.get('apiKey');
        const provider = params.get('provider');
        const endpoint = params.get('endpoint');

        if (apiKey && provider) {
            loadApiKey(apiKey, provider, endpoint);
        } else {
            // Also check sessionStorage in case the page is reloaded
            const storedKey = sessionStorage.getItem('userApiKey');
            const storedProvider = sessionStorage.getItem('apiProvider');
            if(storedKey && storedProvider) {
                loadApiKey(storedKey, storedProvider, sessionStorage.getItem('userEndpointUrl'));
            }
        }
    }

    function setupNavigation() {
        const navTabs = document.querySelectorAll('.nav-tab');
        navTabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.target)));

        const principleBtns = document.querySelectorAll('.lean-principle-btn');
        principleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                principleBtns.forEach(b => b.classList.remove('ring-2', 'ring-blue-500', 'ring-offset-2'));
                btn.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2');
                updateWasteChart(btn.dataset.principle);
            });
        });

        const blueprintTabs = document.querySelectorAll('.blueprint-tab');
        blueprintTabs.forEach(tab => tab.addEventListener('click', () => switchBlueprintTab(tab.dataset.bptarget)));
    }

    function switchTab(targetId) {
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.toggle('hidden', section.id !== targetId);
            if (section.id === targetId) section.classList.add('section-fade-in');
        });
        document.querySelectorAll('.nav-tab').forEach(tab => {
            const isActive = tab.dataset.target === targetId;
            tab.classList.toggle('nav-tab-active', isActive);
            tab.classList.toggle('nav-tab-inactive', !isActive);
        });
    }
    
    function switchBlueprintTab(targetId) {
        document.querySelectorAll('.blueprint-content').forEach(content => content.classList.toggle('hidden', content.id !== targetId));
        document.querySelectorAll('.blueprint-tab').forEach(t => {
            const isActive = t.dataset.bptarget === targetId;
            t.classList.toggle('border-blue-600', isActive);
            t.classList.toggle('text-blue-600', isActive);
            t.classList.toggle('border-transparent', !isActive);
            t.classList.toggle('text-gray-500', !isActive);
        });
    }
    
    function showToast(message, isError = false) {
        const toast = document.getElementById('toast-message');
        toast.textContent = message;
        toast.classList.toggle('error', isError);
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    async function callAI(prompt, button) {
        if (!userApiKey) {
            showToast('éŒ¯èª¤ï¼šAPI é‡‘é‘°æœªè¨­å®šã€‚è«‹å¾ä¸»èª²ç¨‹é é¢é‡æ–°é€²å…¥ã€‚', true);
            return null;
        }

        const buttonText = button.querySelector('.gemini-button-text');
        const loader = button.querySelector('.loader');
        
        buttonText.classList.add('hidden');
        loader.classList.remove('hidden');
        button.disabled = true;

        let apiUrl = '';
        let headers = { 'Content-Type': 'application/json' };
        let body = {};

        if (apiProvider === 'gemini') {
            apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${userApiKey}`;
            body = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
        } else if (apiProvider === 'deepseek') {
            apiUrl = 'https://api.deepseek.com/v1/chat/completions';
            headers['Authorization'] = `Bearer ${userApiKey}`;
            body = { model: "deepseek-chat", messages: [{ role: "system", content: "ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„é¡§å•ï¼Œè«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚" }, { role: "user", content: prompt }] };
        } else if (apiProvider === 'chatgpt') {
            apiUrl = 'https://api.openai.com/v1/chat/completions';
            headers['Authorization'] = `Bearer ${userApiKey}`;
            body = { model: "gpt-3.5-turbo", messages: [{ role: "system", content: "You are a helpful assistant. Please respond in Traditional Chinese." }, { role: "user", content: prompt }] };
        } else if (apiProvider === 'copilot') {
            apiUrl = userEndpointUrl;
            headers['api-key'] = userApiKey;
            body = { messages: [{ role: "system", content: "You are a helpful assistant. Please respond in Traditional Chinese." }, { role: "user", content: prompt }] };
        }

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(body)
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š ${response.status}. ${errorBody}`);
            }

            const result = await response.json();
            
            if (apiProvider === 'gemini' && result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            } else if (['deepseek', 'chatgpt', 'copilot'].includes(apiProvider) && result.choices && result.choices[0]?.message?.content) {
                return result.choices[0].message.content;
            }
            
            throw new Error('å¾APIæ”¶åˆ°çš„å›æ‡‰ç„¡æ•ˆã€‚');
        } catch (error) {
            console.error('AI API å‘¼å«éŒ¯èª¤:', error);
            showToast(error.message || 'ç„¡æ³•ç”Ÿæˆå…§å®¹ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', true);
            return null;
        } finally {
            buttonText.classList.remove('hidden');
            loader.classList.add('hidden');
            button.disabled = false;
        }
    }
    
    function setupGeminiFeatures() {
        const kaizenButton = document.getElementById('generate-kaizen-ideas');
        const kaizenProblem = document.getElementById('kaizen-problem');
        const kaizenOutput = document.getElementById('kaizen-output');

        kaizenButton.addEventListener('click', async () => {
            if (!kaizenProblem.value.trim()) {
                showToast('è«‹å…ˆæè¿°æ‚¨é‡åˆ°çš„å•é¡Œã€‚', true);
                return;
            }
            
            const prompt = `æ‰®æ¼”ä¸€ä½ç²¾å¯¦ç”Ÿç”¢å°ˆå®¶ã€‚é‡å°ä»¥ä¸‹çš„è£½é€ æ¥­å•é¡Œï¼Œè«‹ä½¿ç”¨SCAMPERæ³•ï¼ˆæ›¿ä»£ã€çµåˆã€èª¿æ•´ã€ä¿®æ”¹ã€æŒªä½œä»–ç”¨ã€æ¶ˆé™¤ã€é‡æ’ï¼‰ï¼Œæå‡ºè‡³å°‘5å€‹å…·é«”ä¸”å‰µæ–°çš„æ”¹å–„é»å­ã€‚è«‹ä»¥æ¢åˆ—å¼ã€ç¹é«”ä¸­æ–‡å›ç­”ã€‚\n\nå•é¡Œæè¿°ï¼š${kaizenProblem.value}`;
            
            const result = await callAI(prompt, kaizenButton);

            if(result) {
                kaizenOutput.textContent = result;
                kaizenOutput.classList.remove('hidden');
            }
        });

        const sopButton = document.getElementById('generate-sop');
        const sopTask = document.getElementById('sop-task');
        const sopSteps = document.getElementById('sop-steps');
        const sopSafety = document.getElementById('sop-safety');
        const sopOutputContainer = document.getElementById('sop-output-container');
        const sopOutput = document.getElementById('sop-output');
        const copySopButton = document.getElementById('copy-sop');

        sopButton.addEventListener('click', async () => {
            if (!sopTask.value.trim() || !sopSteps.value.trim()) {
                showToast('è«‹å¡«å¯«ä½œæ¥­åç¨±èˆ‡é—œéµæ­¥é©Ÿã€‚', true);
                return;
            }
            
            const prompt = `æ‰®æ¼”ä¸€ä½å°ˆæ¥­çš„æŠ€è¡“æ–‡ä»¶æ’°å¯«è€…ã€‚è«‹ç‚ºè£½é€ æ¥­ç¾å ´è‰æ“¬ä¸€ä»½æ¨™æº–ä½œæ¥­ç¨‹åº(SOP)ã€‚\n\n- **ä½œæ¥­åç¨±**: ${sopTask.value}\n- **ç›®æ¨™è®€è€…**: æ–°é€²æ“ä½œå“¡\n- **é—œéµæ­¥é©Ÿ**:\n${sopSteps.value}\n- **å®‰å…¨æ³¨æ„äº‹é …**:\n${sopSafety.value || 'ç„¡'}\n\nè«‹æ ¹æ“šä»¥ä¸Šè³‡è¨Šï¼Œç”Ÿæˆä¸€ä»½çµæ§‹å®Œæ•´ã€èªè¨€ç°¡æ½”æ¸…æ™°çš„SOPæ–‡ä»¶ã€‚æ–‡ä»¶æ‡‰åŒ…å«ç›®çš„ã€é©ç”¨ç¯„åœã€ä½œæ¥­æ­¥é©Ÿã€å®‰å…¨æ³¨æ„äº‹é …ç­‰ç« ç¯€ã€‚è«‹ä»¥ç¹é«”ä¸­æ–‡çš„å°ˆæ¥­è¡“èªå›ç­”ã€‚`;
            
            const result = await callAI(prompt, sopButton);

            if(result) {
                sopOutput.textContent = result;
                sopOutputContainer.classList.remove('hidden');
            }
        });
        
        copySopButton.addEventListener('click', () => {
             const textToCopy = sopOutput.textContent;
             const textArea = document.createElement('textarea');
             textArea.value = textToCopy;
             document.body.appendChild(textArea);
             textArea.select();
             try {
                 document.execCommand('copy');
                 showToast('SOPå…§å®¹å·²è¤‡è£½ï¼');
             } catch (err) {
                 showToast('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚', true);
             }
             document.body.removeChild(textArea);
        });
    }

    function populateToolbox() {
        const container = document.getElementById('ie-tools-container');
        container.innerHTML = appData.ieTools.map(tool => `
            <div class="p-5 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="font-bold text-gray-800">${tool.name}</h4>
                <p class="text-sm text-gray-500 mt-2"><strong class="text-gray-700">å‚³çµ±ï¼š</strong>${tool.traditional}</p>
                <p class="text-sm text-blue-700 mt-2"><strong class="text-blue-800">AIå¢å¼·ï¼š</strong>${tool.ai}</p>
            </div>
        `).join('');
    }

    function populateVSMSteps() {
        const container = document.getElementById('vsm-steps');
        const descriptionEl = document.getElementById('vsm-step-description');
        container.innerHTML = appData.vsmSteps.map((step, index) => `
            <button class="w-full text-left p-4 rounded-lg transition-all hover:bg-gray-100 vsm-step-btn border" data-index="${index}">
                <span class="font-semibold text-blue-700">${step.name}</span>
            </button>
        `).join('');
        
        container.addEventListener('click', (e) => {
            const button = e.target.closest('.vsm-step-btn');
            if (button) {
                const index = button.dataset.index;
                descriptionEl.innerHTML = `<p>${appData.vsmSteps[index].description}</p>`;
                descriptionEl.classList.add('section-fade-in');
                setTimeout(() => descriptionEl.classList.remove('section-fade-in'), 500);
                
                document.querySelectorAll('.vsm-step-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-100', 'border-blue-400');
                    btn.classList.add('border-gray-200');
                });
                button.classList.add('bg-blue-100', 'border-blue-400');
                button.classList.remove('border-gray-200');
            }
        });
    }
    
    function populateAccordion() {
        const container = document.getElementById('accordion-container');
        container.innerHTML = appData.prompts.map(prompt => `
            <div>
                <button class="accordion-toggle w-full flex justify-between items-center text-left p-4 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200">
                    <span class="font-semibold text-gray-800">${prompt.title}</span>
                    <span class="transform transition-transform duration-300 text-blue-600 font-bold text-lg">+</span>
                </button>
                <div class="accordion-content">
                    <p class="p-4 text-sm bg-white border-l-4 border-blue-300 text-gray-700 mt-1">${prompt.content}</p>
                </div>
            </div>
        `).join('');

        container.addEventListener('click', e => {
            const toggle = e.target.closest('.accordion-toggle');
            if (toggle) {
                const content = toggle.nextElementSibling;
                const icon = toggle.querySelector('span:last-child');
                const isOpening = !content.style.maxHeight;

                document.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
                document.querySelectorAll('.accordion-toggle span:last-child').forEach(i => { i.textContent = '+'; i.style.transform = 'rotate(0deg)'; });

                if (isOpening) {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.textContent = 'âˆ’';
                    icon.style.transform = 'rotate(180deg)';
                }
            }
        });
    }

    function populateRoadmap() {
        const container = document.querySelector('#guide .relative.text-sm');
        container.innerHTML += appData.roadmap.map(item => `
            <div class="relative mb-5 pl-8">
                <div class="absolute left-0 top-1.5 w-4 h-4 bg-blue-600 rounded-full -ml-[1px] border-4 border-white"></div>
                <p class="font-bold text-gray-800">${item.stage}</p>
                <p class="text-gray-600">${item.tasks}</p>
            </div>
        `).join('');
    }
    
    function updateWasteChart(principleKey) {
        const principle = appData.principles[principleKey];
        document.getElementById('principle-title').textContent = `AIåœ¨ã€Œ${principle.title}ã€ä¸­å°æ¶ˆé™¤æµªè²»çš„å½±éŸ¿åŠ›`;
        document.getElementById('principle-details').textContent = principle.details;
        
        charts.waste.data.datasets[0].data = Object.values(principle.wastes);
        charts.waste.update();
    }

    function createCharts() {
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    titleFont: { size: 14 },
                    bodyFont: { size: 12 },
                    padding: 10,
                },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: (value) => value + '%',
                    font: { weight: 'bold', size: 10 },
                    color: '#4b5563'
                }
            },
        };

        const wasteCtx = document.getElementById('wasteChart').getContext('2d');
        charts.waste = new Chart(wasteCtx, {
            type: 'bar',
            data: {
                labels: ['ä¸è‰¯/é‡å·¥', 'ç”Ÿç”¢éå‰©', 'ç­‰å¾…', 'æ¬é‹', 'åŠ å·¥', 'åº«å­˜', 'å‹•ä½œ'],
                datasets: [{
                    label: 'AIå½±éŸ¿åŠ›',
                    data: Object.values(appData.principles.value.wastes),
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: { ...chartOptions, scales: { y: { beginAtZero: true, max: 55, ticks: { callback: value => value + '%' } } } }
        });

        const vsmCtx = document.getElementById('vsmChart').getContext('2d');
        charts.vsm = new Chart(vsmCtx, {
            type: 'doughnut',
            data: {
                labels: ['å¢å€¼æ™‚é–“ (Value-Added)', 'éå¢å€¼æµªè²» (Waste)'],
                datasets: [{ data: [15, 85], backgroundColor: ['#10b981', '#ef4444'], borderColor: '#fff', borderWidth: 2 }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'æµç¨‹æ¢å‹˜æ­ç¤ºçš„å…¸å‹æ™‚é–“åˆ†ä½ˆ' } } }
        });

        const qualityCtx = document.getElementById('qualityChart').getContext('2d');
        charts.quality = new Chart(qualityCtx, {
            type: 'line',
            data: {
                labels: ['ç”¢å“A', 'ç”¢å“B', 'ç”¢å“C', 'ç”¢å“D', 'ç”¢å“E'],
                datasets: [
                    { label: 'AIæª¢æ¸¬ä¸è‰¯ç‡', data: [0.2, 0.1, 0.3, 0.1, 0.2], borderColor: '#0d6efd', tension: 0.3, fill: false },
                    { label: 'å‚³çµ±AOIä¸è‰¯ç‡', data: [5, 8, 4, 6, 7], borderColor: '#6c757d', tension: 0.3, fill: false }
                ]
            },
            options: { ...chartOptions, plugins: {...chartOptions.plugins, legend: { display: true, position: 'bottom' }, title: { display: true, text: 'AIè¦–è¦ºæª¢æ¸¬vså‚³çµ±AOIä¸è‰¯ç‡ (%)' }}, scales: { y: { beginAtZero: true, ticks: { callback: value => value + '%' } } } }
        });

        const pdmCtx = document.getElementById('pdmChart').getContext('2d');
        charts.pdm = new Chart(pdmCtx, {
            type: 'line',
            data: {
                labels: ['ç¬¬1é€±', 'ç¬¬2é€±', 'ç¬¬3é€±', 'ç¬¬4é€±', 'ç¬¬5é€±', 'ç¬¬6é€±', 'ç¬¬7é€±', 'ç¬¬8é€±'],
                datasets: [{
                    label: 'è¨­å‚™å¥åº·åº¦',
                    data: [98, 95, 90, 82, 70, 60, 52, 45],
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: { ...chartOptions, plugins: {...chartOptions.plugins, title: { display: true, text: 'ä¸»è»¸å‰©é¤˜å£½å‘½é æ¸¬ (RUL)' }}, scales: { y: { min: 0, max: 100, ticks: { callback: value => value + '%' } } } }
        });
        
        const roiCtx = document.getElementById('roiChart').getContext('2d');
        charts.roi = new Chart(roiCtx, {
            type: 'pie',
            data: {
                labels: ['é™ä½ç¶­è­·æˆæœ¬', 'æ¸›å°‘åœæ©Ÿæå¤±', 'æå‡ç”¢å‡ºå“è³ª', 'ç¯€çœèƒ½æº'],
                datasets: [{ data: [35, 30, 20, 15], backgroundColor: ['#0d6efd', '#6ea8fe', '#9ec5fe', '#c7dfff'], borderColor: '#fff', borderWidth: 2 }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'å…¸å‹PdMå°ˆæ¡ˆæŠ•è³‡å›å ±(ROI)çµ„æˆ' } } }
        });
    }
    
    init();

});
</script>

</body>
</html>
